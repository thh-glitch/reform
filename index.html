<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­åœ‹æ­·å²å°ˆé¡Œï¼šæ™šæ¸…æ”¹é©</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Noto+Serif+TC:wght@700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .font-serif {
            font-family: 'Noto Serif TC', serif;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Custom scrollbar for chat */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e; 
        }
        
        .stat-bar-transition {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-stone-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // --- Internal Icon Components ---
        
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Icons = {
            BookOpen: (props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></IconBase>,
            Users: (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>,
            Sword: (props) => <IconBase {...props}><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/><line x1="13" y1="19" x2="19" y2="13"/><line x1="16" y1="16" x2="20" y2="20"/><line x1="19" y1="21" x2="21" y2="19"/></IconBase>,
            Scroll: (props) => <IconBase {...props}><path d="M8 19l-3 3h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-4.32a2 2 0 0 1-1.68-1.1l-.32-.64a2 2 0 0 0-1.68-1.1H6a2 2 0 0 0-2 2v2"/><path d="M15 3h6v18h-6M10 21v-2a2 2 0 0 1 2-2h4M10 3v18"/></IconBase>,
            AlertTriangle: (props) => <IconBase {...props}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></IconBase>,
            CheckCircle: (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>,
            ArrowRight: (props) => <IconBase {...props}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></IconBase>,
            History: (props) => <IconBase {...props}><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></IconBase>,
            Scale: (props) => <IconBase {...props}><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></IconBase>,
            Anchor: (props) => <IconBase {...props}><circle cx="12" cy="5" r="3"/><line x1="12" y1="22" x2="12" y2="8"/><path d="M5 12H2a10 10 0 0 0 20 0h-3"/></IconBase>,
            Landmark: (props) => <IconBase {...props}><line x1="3" y1="22" x2="21" y2="22"/><line x1="6" y1="18" x2="6" y2="11"/><line x1="10" y1="18" x2="10" y2="11"/><line x1="14" y1="18" x2="14" y2="11"/><line x1="18" y1="18" x2="18" y2="11"/><polygon points="12 2 20 7 4 7"/></IconBase>,
            Sparkles: (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></IconBase>,
            MessageCircle: (props) => <IconBase {...props}><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></IconBase>,
            Send: (props) => <IconBase {...props}><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></IconBase>,
            Bot: (props) => <IconBase {...props}><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/></IconBase>,
            User: (props) => <IconBase {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>,
            X: (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconBase>,
            Lightbulb: (props) => <IconBase {...props}><line x1="9" y1="18" x2="15" y2="18"/><line x1="10" y1="22" x2="14" y2="22"/><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 9.5 6 4.65 4.65 0 0 0 8 10.5c0 1.99.78 2.87 2.5 4.41"/><path d="M12 18h.01"/></IconBase>,
            Factory: (props) => <IconBase {...props}><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M17 18h1"/><path d="M12 18h1"/><path d="M7 18h1"/></IconBase>,
            Ship: (props) => <IconBase {...props}><path d="M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 .6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M19.38 20A11.6 11.6 0 0 0 21 14l-9-4-9 4c0 2.9.9 5.8 1.62 6"/><path d="M12 10V4"/><path d="M8 8v1"/><path d="M16 8v1"/><path d="M12 2v6"/><path d="M12 8a2 2 0 0 0-2-2"/><path d="M12 8a2 2 0 0 1 2-2"/></IconBase>,
            Gamepad2: (props) => <IconBase {...props}><line x1="6" y1="11" x2="10" y2="11"/><line x1="8" y1="9" x2="8" y2="13"/><line x1="15" y1="12" x2="15.01" y2="12"/><line x1="18" y1="10" x2="18.01" y2="10"/><path d="M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z"/></IconBase>,
            Skull: (props) => <IconBase {...props}><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="M12.5 17l-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></IconBase>,
            Trophy: (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>,
            TrendingDown: (props) => <IconBase {...props}><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></IconBase>,
            TrendingUp: (props) => <IconBase {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconBase>,
            Coins: (props) => <IconBase {...props}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></IconBase>
        };

        const { 
            BookOpen, Users, Sword, Scroll, AlertTriangle, CheckCircle, 
            ArrowRight, History, Scale, Anchor, Landmark, Sparkles, 
            MessageCircle, Send, Bot, User, X, Lightbulb, Factory, Ship,
            Gamepad2, Skull, Trophy, TrendingDown, TrendingUp, Coins
        } = Icons;

        const QingReformLesson = () => {
          const [activeTab, setActiveTab] = useState('intro');

          const tabs = [
            { id: 'intro', label: 'èª²å ‚å°è¨€', icon: <History size={20} /> },
            { id: 'yangwu', label: 'æ´‹å‹™é‹å‹•', icon: <Anchor size={20} /> },
            { id: 'wuxu', label: 'æˆŠæˆŒç¶­æ–°', icon: <Scroll size={20} /> },
            { id: 'compare', label: 'æ¯”è¼ƒèˆ‡ç¸½çµ', icon: <Scale size={20} /> },
            { id: 'ai-lab', label: 'AI æ­·å²å¯¦é©—å®¤', icon: <Sparkles size={20} /> },
            { id: 'game', label: 'ç”Ÿå­˜æŒ‘æˆ°', icon: <Gamepad2 size={20} /> },
          ];

          const renderContent = () => {
            switch (activeTab) {
              case 'intro':
                return <IntroSection setActiveTab={setActiveTab} />;
              case 'yangwu':
                return <YangwuSection />;
              case 'wuxu':
                return <WuxuSection />;
              case 'compare':
                return <CompareSection />;
              case 'ai-lab':
                return <AiLabSection />;
              case 'game':
                return <GameSection />;
              default:
                return <IntroSection setActiveTab={setActiveTab} />;
            }
          };

          return (
            <div className="min-h-screen bg-stone-100 font-sans text-stone-800">
              {/* Header */}
              <header className="bg-red-900 text-amber-50 p-6 shadow-lg">
                <div className="max-w-5xl mx-auto flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <BookOpen size={32} />
                    <div>
                      <h1 className="text-2xl font-bold tracking-wide">ä¸­åœ‹æ­·å²å°ˆé¡Œï¼šæ™šæ¸…æ”¹é©</h1>
                      <p className="text-sm text-red-200 opacity-90">æˆèª²è€å¸«ï¼šAI æ­·å²å°å¸«</p>
                    </div>
                  </div>
                  <div className="hidden md:block text-sm bg-red-800 px-4 py-2 rounded-full border border-red-700">
                    ä¸»é¡Œï¼šæ´‹å‹™é‹å‹• èˆ‡ æˆŠæˆŒç¶­æ–°
                  </div>
                </div>
              </header>

              {/* Main Content Area */}
              <main className="max-w-5xl mx-auto p-4 md:p-6">
                {/* Navigation Tabs */}
                <div className="flex flex-wrap gap-2 mb-6 bg-white p-2 rounded-xl shadow-sm">
                  {tabs.map((tab) => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 font-medium flex-1 justify-center whitespace-nowrap
                        ${activeTab === tab.id 
                          ? 'bg-red-800 text-white shadow-md' 
                          : (tab.id === 'ai-lab' || tab.id === 'game')
                            ? 'bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200'
                            : 'bg-stone-50 text-stone-600 hover:bg-stone-200'}`}
                    >
                      {tab.icon}
                      {tab.label}
                    </button>
                  ))}
                </div>

                {/* Dynamic Content Content */}
                <div className="bg-white rounded-2xl shadow-xl p-6 md:p-8 min-h-[500px] transition-all relative">
                  {renderContent()}
                </div>
              </main>

              <footer className="text-center py-6 text-stone-500 text-sm">
                <p>Â© 2024 ä¸­åœ‹æ­·å²äº’å‹•èª²å ‚ | æ™šæ¸…æ•‘åœ‹é‹å‹•å°ˆé¡Œ | Powered by Gemini</p>
              </footer>
            </div>
          );
        };

        // --- Game Section Component ---

        const ProgressBar = ({ value, max, label, icon, colorClass }) => {
            const percentage = Math.max(0, Math.min(100, (value / max) * 100));
            return (
                <div className="flex flex-col w-full">
                    <div className="flex justify-between text-xs font-bold mb-1 text-stone-200">
                        <span className="flex items-center gap-1">{icon} {label}</span>
                        <span>{value}/{max}</span>
                    </div>
                    <div className="h-3 w-full bg-stone-700 rounded-full overflow-hidden border border-stone-600">
                        <div 
                            className={`h-full ${colorClass} stat-bar-transition relative`}
                            style={{ width: `${percentage}%` }}
                        >
                            {/* Shine effect */}
                            <div className="absolute top-0 left-0 bottom-0 right-0 bg-white opacity-20"></div>
                        </div>
                    </div>
                </div>
            );
        };

        const GameSection = () => {
          const [gameState, setGameState] = useState('menu'); // menu, playing, feedback, result
          const [track, setTrack] = useState(null); // 'yangwu' or 'wuxu'
          const [currentLevel, setCurrentLevel] = useState(0);
          const [stats, setStats] = useState({ power: 60, money: 60 }); 
          const [log, setLog] = useState([]);
          const [feedback, setFeedback] = useState(null); // Store data for feedback screen

          const scenarios = {
            yangwu: {
              title: "æ´‹å‹™å¤§è‡£çš„è‰±é›£æŠ‰æ“‡",
              role: "æé´»ç« ",
              desc: "ä½ æ˜¯ç›´éš¸ç¸½ç£æé´»ç« ã€‚ä½ çš„ç›®æ¨™æ˜¯å»ºç«‹å¼·å¤§çš„æµ·è»å’Œå·¥æ¥­ï¼Œä½†ä½ å¿…é ˆé¢å°ç¼ºéŒ¢ã€ä¿å®ˆæ´¾åå°ä»¥åŠå¤ªåæŒªç”¨è»è²»çš„ç¾å¯¦ã€‚",
              levels: [
                {
                  question: "ã€å¤ªå¹³å¤©åœ‹æ®˜éƒ¨ã€‘æˆ°äº‚å‰›å¹³ï¼Œæ˜¯å¦è£æ’¤æ›¾åœ‹è—©çš„æ¹˜è»ä»¥ç¯€çœé–‹æ”¯ï¼Ÿ",
                  choices: [
                    { 
                      text: "è£æ’¤æ¹˜è»ï¼Œæ”¹ç”¨ç¶ ç‡Ÿ", 
                      effect: { power: -10, money: +20 }, 
                      result: "ç¯€çœäº†å¤§é‡è»é¤‰ï¼Œä½†ç¶ ç‡Ÿæˆ°é¬¥åŠ›ä½ä¸‹ï¼Œåœ°æ–¹æ²»å®‰æƒ¡åŒ–ï¼Œä½ çš„è»äº‹å½±éŸ¿åŠ›ä¹Ÿæ¸›å¼±äº†ã€‚" 
                    },
                    { 
                      text: "ä¿ç•™ç²¾éŠ³ï¼Œç·¨ç·´é˜²è»", 
                      effect: { power: +10, money: -15 }, 
                      result: "é›–ç„¶é–‹æ”¯å·¨å¤§ï¼Œä½†ä½ ä¿ç•™äº†ä¸€æ”¯å¯é çš„è»äº‹åŠ›é‡ï¼Œç‚ºæ—¥å¾Œçš„æ·®è»å´›èµ·å¥ å®šåŸºç¤ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€ç•™ç¾å¹¼ç«¥ã€‘å®¹é–å»ºè­°é¸æ´¾å¹¼ç«¥èµ´ç¾ç•™å­¸ï¼Œå­¸ç¿’è¥¿æ–¹ç§‘æŠ€ã€‚",
                  choices: [
                    { 
                      text: "æ”¯æŒä¸¦è³‡åŠ©ï¼Œæ´¾é£å¹¼ç«¥", 
                      effect: { power: -5, money: -10 }, 
                      result: "é€™æ˜¯ä¸€é …é•·é æŠ•è³‡ã€‚é›–ç„¶ä¿å®ˆæ´¾æ‰¹è©•å¹¼ç«¥ã€Œè¥¿åŒ–ã€ï¼Œä½†æœªä¾†ä»–å€‘å°‡æˆç‚ºéµè·¯ã€ç¤¦å†¶çš„æ£Ÿæ¨‘ï¼ˆå¦‚è©¹å¤©ä½‘ï¼‰ã€‚" 
                    },
                    { 
                      text: "æ“”å¿ƒè¥¿åŒ–ï¼Œæ‹’çµ•æ´¾é£", 
                      effect: { power: +5, money: +0 }, 
                      result: "ä¿å®ˆæ´¾ç¨±è®šä½ ã€Œè­˜å¤§é«”ã€ï¼Œä½†ä¸­åœ‹éŒ¯å¤±äº†åŸ¹é¤Šç¬¬ä¸€æ‰¹ç¾ä»£å·¥ç¨‹å¸«çš„æ©Ÿæœƒã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€ç±Œè¾¦è»å‹™ã€‘æœå»·æ’¥æ¬¾ä¸è¶³ï¼Œå»ºç«‹åŒ—æ´‹æ°´å¸«éœ€è¦å¤§é‡éŠ€å…©ï¼Œä½ è©²å¦‚ä½•ç±ŒéŒ¢ï¼Ÿ",
                  choices: [
                    { 
                      text: "å‘å¤–åœ‹éŠ€è¡Œé«˜æ¯å€Ÿæ¬¾", 
                      effect: { power: -10, money: +30 }, 
                      result: "ä½ ç±Œåˆ°äº†éŒ¢ï¼Œè²·äº†æ–°èˆ¹ï¼Œä½†èƒŒè² äº†æ²ˆé‡çš„å¤–å‚µï¼Œæœä¸­æ¸…æµæ´¾å½ˆåŠ¾ä½ ã€Œè³£åœ‹ã€ã€‚" 
                    },
                    { 
                      text: "è«‹æ±‚å„åœ°ç£æ’«å”é¤‰", 
                      effect: { power: -5, money: +10 }, 
                      result: "å„åœ°ç£æ’«æ¨ä¸‰é˜»å››ï¼Œåªç±Œåˆ°å°‘é‡æ¬¾é …ï¼Œè‰¦éšŠç™¼å±•ç·©æ…¢ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€å¤©æ´¥æ•™æ¡ˆã€‘å¤©æ´¥ç™¼ç”Ÿæ°‘çœ¾æ‰“æ­»å¤–åœ‹é ˜äº‹èˆ‡æ•™å£«äº‹ä»¶ï¼Œåˆ—å¼·è»è‰¦é›†çµï¼Œå½¢å‹¢å±æ€¥ã€‚",
                  choices: [
                    { 
                      text: "åš´æ‡²è‚‡äº‹æ°‘çœ¾ï¼Œè³ æ¬¾é“æ­‰", 
                      effect: { power: -25, money: -15 }, 
                      result: "åˆ—å¼·é€€å…µäº†ï¼Œä½†ä½ è¢«ç™¾å§“ç½µç‚ºã€Œæ¼¢å¥¸ã€ï¼Œåœ¨å£«å¤§å¤«ä¸­è²æœ›å¤§è·Œã€‚" 
                    },
                    { 
                      text: "æ‹’çµ•è³ æ¬¾ï¼Œæº–å‚™é–‹æˆ°", 
                      effect: { power: +10, money: -40 }, 
                      result: "é›–ç„¶è´å¾—äº†æ°‘å¿ƒï¼Œä½†è»å‚™å°šæœªå®Œæˆï¼Œç‚ºäº†å‚™æˆ°è€—ç›¡äº†å‰›ç±Œåˆ°çš„è³‡é‡‘ï¼Œç™¼å±•åœæ»¯ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€ä¸­æ³•æˆ°çˆ­ã€‘æ³•åœ‹ä¾µç•¥è¶Šå—èˆ‡å°ç£ï¼Œä¸»æˆ°æ´¾ç¾¤æƒ…æ¿€æ†¤ã€‚",
                  choices: [
                    { 
                      text: "è¶å‹æ±‚å’Œï¼Œç°½è¨‚æ¢ç´„", 
                      effect: { power: -15, money: -10 }, 
                      result: "ã€Œä¸æ•—è€Œæ•—ã€ï¼Œä½ ä¿ä½äº†å—æ´‹æ°´å¸«çš„å¯¦åŠ›ï¼Œä½†è¢«åœ‹äººç—›ç½µæ‡¦å¼±ã€‚" 
                    },
                    { 
                      text: "è¡€æˆ°åˆ°åº•ï¼Œæ‹’çµ•è«‡åˆ¤", 
                      effect: { power: +5, money: -30 }, 
                      result: "é›–ç„¶å–å¾—é®å—é—œå¤§æ·ï¼Œä½†åœ‹åº«å†æ¬¡è¦‹åº•ï¼Œä¸”ç¦å»ºæ°´å¸«å…¨è»è¦†æ²’ï¼Œæå¤±æ…˜é‡ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€ä¿®ç¯‰éµè·¯ã€‘ä½ æè­°ä¿®ç¯‰éµè·¯é‹ç…¤ï¼Œä½†è¨€å®˜åå°ï¼Œèªªéµè·¯æœƒã€Œé©šå‹•é¾è„ˆï¼Œç ´å£é¢¨æ°´ã€ã€‚",
                  choices: [
                    { 
                      text: "å …æŒä¿®ç¯‰ï¼Œå¼·è¡Œå¾µåœ°", 
                      effect: { power: -20, money: +20 }, 
                      result: "éµè·¯ä¿®æˆäº†ï¼Œç…¤ç¤¦é‹è¼¸æˆæœ¬å¤§é™ã€‚ä½†ä½ å¾—ç½ªäº†å¤§é‡ä¿å®ˆæ´¾å®˜å“¡ï¼Œä»–å€‘æ­£ä¼ºæ©Ÿå ±å¾©ã€‚" 
                    },
                    { 
                      text: "å¦¥å”ï¼Œæ”¹ç”¨é¨¾é¦¬æ‹‰ç«è»Š", 
                      effect: { power: -5, money: -10 }, 
                      result: "é¬§å‡ºäº†ã€Œé¦¬æ‹‰ç«è»Šã€çš„åœ‹éš›ç¬‘è©±ï¼Œé›–ç„¶å¹³æ¯äº†é¢¨æ°´ä¹‹çˆ­ï¼Œä½†é‹è¼¸æ•ˆç‡æ¥µä½ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€å¤ªåä¿®åœ’ã€‘æ…ˆç¦§å¤ªåæƒ³ä¿®é ¤å’Œåœ’æ…¶ç¥å£½è¾°ï¼Œæš—ç¤ºè¦æŒªç”¨æµ·è»è»è²»ã€‚",
                  choices: [
                    { 
                      text: "å …æ±ºåå°ï¼Œä¸Šæ›¸ç›´è««", 
                      effect: { power: -40, money: +0 }, 
                      result: "å¤ªåå¤§æ€’ï¼Œé›–æœªç•¶å ´ç½·å…ä½ ï¼Œä½†ä½ å¤±å»äº†æ”¿æ²»é å±±ï¼Œå¯¸æ­¥é›£è¡Œã€‚æµ·è»è»è²»ä¾ç„¶è¢«å…¶ä»–é€”å¾‘æŒªèµ°ã€‚" 
                    },
                    { 
                      text: "é»˜è¨±æŒªç”¨ï¼Œä»¥æ­¤è¨å¥½å¤ªå", 
                      effect: { power: +20, money: -30 }, 
                      result: "å¤ªåå¾ˆé«˜èˆˆï¼Œä½ çš„å®˜ä½æ›´ç©©äº†ã€‚ä½†åŒ—æ´‹æ°´å¸«å¤šå¹´æœªæ·»æ–°è‰¦ï¼Œç«ç‚®ä¹Ÿæ²’éŒ¢æ›´æ›å½ˆè—¥ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€ç”²åˆé¢¨é›²ã€‘æ—¥æœ¬è‰¦éšŠä¾†è¥²ï¼ŒåŒ—æ´‹æ°´å¸«é¢è‡¨æ±ºæˆ°ã€‚",
                  choices: [
                    { 
                      text: "ä¸»å‹•å‡ºæ“Šï¼Œæ±ºä¸€æ­»æˆ°", 
                      effect: { power: -20, money: -20 }, 
                      result: "é›–ç„¶å°‡å£«ç”¨å‘½ï¼Œä½†å› è£å‚™è½å¾Œä¸”å½ˆè—¥ä¸è¶³ï¼Œè‰¦éšŠæå¤±æ…˜é‡ã€‚" 
                    },
                    { 
                      text: "é¿æˆ°ä¿èˆ¹ï¼Œèº²å…¥æ¸¯å£", 
                      effect: { power: -50, money: 0 }, 
                      result: "è‰¦éšŠè¢«å›°åœ¨æ¸¯å£ï¼Œæœ€çµ‚è¢«æ—¥è»é™¸è·¯åŒ…æŠ„å…¨æ®²ã€‚ä½ ç°½ç½²äº†å±ˆè¾±çš„é¦¬é—œæ¢ç´„ï¼Œé€™å°±æ˜¯æ´‹å‹™é‹å‹•çš„çµå±€ã€‚" 
                    }
                  ]
                }
              ]
            },
            wuxu: {
              title: "å…‰ç·’å¸çš„ç™¾æ—¥çªåœ",
              role: "å…‰ç·’çš‡å¸",
              desc: "ä½ æ˜¯å¹´è¼•çš„å…‰ç·’å¸ã€‚ä½ ä¸ç”˜å¿ƒåšäº¡åœ‹ä¹‹å›ï¼Œæ±ºå¿ƒè®Šæ³•ã€‚ä½†ä½ æ‰‹ä¸­ç„¡å…µæ¬Šï¼Œä¸Šé¢é‚„æœ‰æ…ˆç¦§å¤ªåã€‚",
              levels: [
                {
                  question: "ã€å…¬è»Šä¸Šæ›¸ã€‘ç”²åˆæˆ°æ•—ï¼Œåº·æœ‰ç‚ºç­‰èˆ‰äººè¯åä¸Šæ›¸ï¼Œè¦æ±‚è®Šæ³•ã€‚",
                  choices: [
                    { 
                      text: "ç ´æ ¼å¬è¦‹ï¼Œæ”¯æŒè®Šæ³•", 
                      effect: { power: +5, money: 0 }, 
                      result: "ä½ å±•ç¾äº†æ”¹é©çš„æ±ºå¿ƒï¼Œç²å¾—äº†ç¶­æ–°æ´¾çš„æ”¯æŒï¼Œä½†ä¹Ÿå¼•èµ·äº†å¤ªåçš„è­¦è¦ºã€‚" 
                    },
                    { 
                      text: "ç½®ä¹‹ä¸ç†ï¼ŒæŒ‰éƒ¨å°±ç­", 
                      effect: { power: -5, money: 0 }, 
                      result: "ä½ éŒ¯å¤±äº†å‡èšæ”¹é©åŠ›é‡çš„æœ€ä½³æ™‚æ©Ÿï¼Œåœ‹å®¶å±æ©Ÿé€²ä¸€æ­¥åŠ æ·±ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€å¸åé»¨çˆ­ã€‘ä½ çš„è€å¸«ç¿åŒé¾¢è¢«å¤ªåé€¼è¿«ç½·å®˜ï¼Œé€™æ˜¯åœ¨å‰Šå¼±ä½ çš„ç¾½ç¿¼ã€‚",
                  choices: [
                    { 
                      text: "æ“šç†åŠ›çˆ­ï¼Œæ‹’çµ•ç½·å…", 
                      effect: { power: -20, money: 0 }, 
                      result: "ä½ èˆ‡å¤ªåçš„é—œä¿‚æå‰ç ´è£‚ï¼Œå¤ªåé–‹å§‹åŠ å¼·å°ä½ çš„ç›£è¦–ï¼Œè®Šæ³•é›£åº¦å¤§å¢ã€‚" 
                    },
                    { 
                      text: "å¿ç—›æ‰¹å‡†ï¼Œæš«æ™‚éš±å¿", 
                      effect: { power: -10, money: 0 }, 
                      result: "ä½ ä¿ä½äº†è¡¨é¢å’Œæ°£ï¼Œä½†å¤±å»äº†æœä¸­æœ€é‡è¦çš„è¦ªä¿¡ï¼Œè®Šæ³•åªèƒ½ä¾é æ¿€é€²çš„æ–°é»¨ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€è®Šæ³•èµ·æ­¥ã€‘åº·æœ‰ç‚ºå»ºè­°ã€Œå…¨è®Šã€ï¼Œè¦çŸ­æ™‚é–“å…§é ’å¸ƒå¤§é‡æ–°æ”¿ã€‚",
                  choices: [
                    { 
                      text: "å¤§åˆ€é—Šæ–§ï¼Œç™¾æ—¥ä¸‹è©”æ•¸åé“", 
                      effect: { power: -15, money: 0 }, 
                      result: "è©”æ›¸å¦‚é›ªç‰‡èˆ¬é£›ä¸‹ï¼Œåœ°æ–¹å®˜å“¡çœ‹éƒ½çœ‹ä¸éä¾†ï¼Œæ ¹æœ¬ç„¡æ³•åŸ·è¡Œï¼Œåè€Œå¼•ç™¼å®˜åƒšé›†åœ˜ææ…Œã€‚" 
                    },
                    { 
                      text: "å¾ªåºæ¼¸é€²ï¼Œå…ˆæŠ“é‡é»", 
                      effect: { power: +5, money: 0 }, 
                      result: "ç¶­æ–°æ´¾å«Œä½ å¤ªæ…¢ï¼Œä¸”å¤ªåä¾ç„¶è­¦æƒ•ã€‚åœ¨æ­·å²çš„æ´ªæµä¸­ï¼Œä½ ä¼¼ä¹æ²’æœ‰æ™‚é–“æ…¢æ…¢ä¾†ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€è£æ’¤å†—å®˜ã€‘ç‚ºäº†æé«˜æ•ˆç‡å’Œç¯€çœé–‹æ”¯ï¼Œéœ€è¦è£æ¸›å¤§é‡é–’æ•£è¡™é–€ã€‚",
                  choices: [
                    { 
                      text: "ç«‹å³è£æ’¤ï¼Œä¸ç•™æƒ…é¢", 
                      effect: { power: -30, money: +20 }, 
                      result: "æ•¸è¬åå®ˆèˆŠå®˜å“¡ä¸Ÿäº†é£¯ç¢—ï¼Œä»–å€‘èšé›†èµ·ä¾†å“­è¨´ï¼Œæˆç‚ºäº†åå°è®Šæ³•çš„æœ€å¼·å¤§åŠ›é‡ã€‚" 
                    },
                    { 
                      text: "çµ¦äºˆè£œè²¼ï¼Œåˆ†æ‰¹è£æ¸›", 
                      effect: { power: -10, money: -15 }, 
                      result: "é˜»åŠ›ç¨å°ï¼Œä½†åœ‹åº«ç„¡åŠ›æ”¯ä»˜é¾å¤§çš„é£æ•£è²»ï¼Œæ”¹é©é™·å…¥åƒµå±€ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€å»¢é™¤å…«è‚¡ã€‘å»¢é™¤å…«è‚¡æ–‡æ˜¯æ•™è‚²æ”¹é©æ ¸å¿ƒï¼Œä½†æœƒæ–·çµ•è®€æ›¸äººå‡ºè·¯ã€‚",
                  choices: [
                    { 
                      text: "ç«‹å³å»¢é™¤ï¼Œæ”¹è©¦ç­–è«–", 
                      effect: { power: -30, money: 0 }, 
                      result: "å…¨åœ‹è®€æ›¸äººï¼ˆæœªä¾†çš„å®˜å“¡ï¼‰ç¾¤æƒ…æ¿€æ†¤ï¼Œè¦–ä½ ç‚ºä»‡æ•µã€‚ä¿å®ˆå‹¢åŠ›è¿…é€Ÿé›†çµåå°ä½ ã€‚" 
                    },
                    { 
                      text: "è¨­ç«‹æ–°å­¸å ‚ï¼Œæš«ç•™å…«è‚¡", 
                      effect: { power: -5, money: -20 }, 
                      result: "æ”¹é©é˜»åŠ›ç¨æ¸›ï¼Œä½†æ–°å­¸å ‚è€—è³‡å·¨å¤§ï¼Œåœ‹åº«ç©ºè™›ï¼Œé›£ä»¥ç‚ºç¹¼ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€å»£é–‹è¨€è·¯ã€‘æ˜¯å¦å…è¨±å¹³æ°‘ç™¾å§“ç›´æ¥ä¸Šæ›¸è¨€äº‹ï¼Ÿ",
                  choices: [
                    { 
                      text: "å…è¨±ä¸Šæ›¸ï¼Œåš´æ‡²é˜»æ””è€…", 
                      effect: { power: +10, money: 0 }, 
                      result: "ä½ æ”¶åˆ°äº†å¤§é‡å»ºè­°ï¼Œä½†ä¹Ÿå¾—ç½ªäº†é«˜ç´šå®˜åƒšï¼Œä»–å€‘èªç‚ºé€™ç ´å£äº†ç­‰ç´šåˆ¶åº¦ã€‚" 
                    },
                    { 
                      text: "åƒ…é™æœ‰åŠŸåè€…ä¸Šæ›¸", 
                      effect: { power: -5, money: 0 }, 
                      result: "æ”¹é©é¡¯å¾—ä¸å¤ å¾¹åº•ï¼Œè¨±å¤šåº•å±¤è²éŸ³ç„¡æ³•å‚³é”ï¼Œç¶­æ–°æ´¾æ„Ÿåˆ°å¤±æœ›ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€ä¼Šè—¤è¨ªè¯ã€‘æ—¥æœ¬å‰é¦–ç›¸ä¼Šè—¤åšæ–‡è¨ªè¯ï¼Œç¶­æ–°æ´¾å»ºè­°è˜è«‹ä»–ç‚ºé¡§å•ã€‚",
                  choices: [
                    { 
                      text: "æ¥è¦‹ä¼Šè—¤ï¼Œå°‹æ±‚æ”¯æŒ", 
                      effect: { power: -25, money: 0 }, 
                      result: "æ­¤èˆ‰è§¸å‹•äº†å¤ªåæ•æ„Ÿçš„ç¥ç¶“ï¼Œå®ˆèˆŠæ´¾é€ è¬ èªªä½ è¦è—‰å¤–åœ‹å…µåŠ›åœæ”»åœ’æ—ã€‚æ”¿è®Šä¸€è§¸å³ç™¼ã€‚" 
                    },
                    { 
                      text: "å©‰è¨€è¬çµ•ï¼Œé¿å…çŒœå¿Œ", 
                      effect: { power: -5, money: 0 }, 
                      result: "ä½ éŒ¯å¤±äº†å¯èƒ½çš„åœ‹éš›æ”¯æŒï¼Œè€Œåœ¨åœ‹å…§ä½ ä¾ç„¶å­¤ç«‹ç„¡æ´ã€‚" 
                    }
                  ]
                },
                {
                  question: "ã€ç”Ÿæ­»å­˜äº¡ã€‘ä¿å®ˆæ´¾å³å°‡ç™¼å‹•æ”¿è®Šï¼Œç¶­æ–°æ´¾å»ºè­°æ‹‰æ”æ‰‹æ¡æ–°è»çš„è¢ä¸–å‡±ã€‚",
                  choices: [
                    { 
                      text: "ä¿¡ä»»è¢ä¸–å‡±ï¼Œä»¤å…¶æ®ºæ¦®ç¥¿", 
                      effect: { power: -100, money: 0 }, 
                      result: "è¢ä¸–å‡±è¡¨é¢ç­”æ‡‰ï¼Œè½‰é ­å°±å‘æ¦®ç¥¿å’Œæ…ˆç¦§å‘Šå¯†ã€‚æ…ˆç¦§ç™¼å‹•æ”¿è®Šï¼Œä½ è¢«å›šç¦ç€›å°ï¼Œå…­å›å­è¢«æ®ºã€‚è®Šæ³•å¤±æ•—ã€‚" 
                    },
                    { 
                      text: "ä¸ä¿¡è¢ä¸–å‡±ï¼Œè©¦åœ–å‡ºé€ƒ", 
                      effect: { power: -50, money: 0 }, 
                      result: "äº¬åŸå·²è¢«å°é–ï¼Œä½ ç„¡è™•å¯é€ƒã€‚çµå±€ä¾ç„¶æ˜¯è¢«å›šç¦ï¼Œè®Šæ³•å¤±æ•—ã€‚" 
                    }
                  ]
                }
              ]
            }
          };

          const startGame = (selectedTrack) => {
            setTrack(selectedTrack);
            setGameState('playing');
            setCurrentLevel(0);
            setStats({ power: 60, money: 60 });
            setLog([]);
            setFeedback(null);
          };

          const handleChoice = (choice) => {
            const newStats = {
              power: Math.max(0, Math.min(100, stats.power + choice.effect.power)),
              money: Math.max(0, Math.min(100, stats.money + choice.effect.money))
            };
            
            // Prepare feedback data
            setFeedback({
                choiceText: choice.text,
                resultText: choice.result,
                effect: choice.effect,
                oldStats: stats,
                newStats: newStats
            });

            // Update stats immediately in background (or wait till next step, but here we update for consistency)
            setStats(newStats);
            
            setLog([...log, { 
              level: currentLevel + 1, 
              question: scenarios[track].levels[currentLevel].question,
              choice: choice.text,
              result: choice.result 
            }]);

            setGameState('feedback');
          };

          const handleNextLevel = () => {
            if (currentLevel < scenarios[track].levels.length - 1) {
              setCurrentLevel(currentLevel + 1);
              setGameState('playing');
            } else {
              setGameState('result');
            }
          };

          if (gameState === 'menu') {
            return (
              <div className="space-y-6 animate-fadeIn">
                <SectionHeader title="ğŸ® æ­·å²ç”Ÿå­˜æŒ‘æˆ°" subtitle="ç©¿è¶Šæ™‚ç©ºï¼Œçœ‹çœ‹ä½ èƒ½å¦æ”¹è®Šå‘½é‹" color="indigo" />
                <div className="grid md:grid-cols-2 gap-6">
                  <div className="bg-red-50 p-6 rounded-xl border-2 border-red-200 hover:border-red-400 cursor-pointer transition-all hover:shadow-lg group" onClick={() => startGame('yangwu')}>
                    <div className="flex items-center gap-3 mb-4">
                      <div className="p-3 bg-red-200 rounded-full group-hover:bg-red-300 transition-colors"><Anchor className="text-red-800" /></div>
                      <div>
                        <h3 className="text-xl font-bold text-red-900">æ´‹å‹™ç·šï¼šæé´»ç« </h3>
                        <span className="text-xs bg-red-200 text-red-800 px-2 py-0.5 rounded-full font-bold">é›£åº¦ï¼šâ­â­â­â­</span>
                      </div>
                    </div>
                    <p className="text-sm text-stone-600 mb-4 leading-relaxed">
                      ä½ éœ€è¦åœ¨è…æ•—çš„å®˜å ´ä¸­å‘¨æ—‹ã€‚æ—¢è¦è¾¦æ´‹å‹™å»ºæµ·è»ï¼Œåˆè¦æ‡‰ä»˜å¤ªåçš„ä¿®åœ’æŒªæ¬¾ã€‚å¤–äº¤ã€æ°‘ç”Ÿã€è»å‚™ï¼Œæ¯ä¸€å€‹æ±ºå®šéƒ½é—œä¹å¤§æ¸…åœ‹é‹ã€‚
                    </p>
                    <button className="mt-2 w-full py-2 bg-red-800 text-white rounded-lg font-bold group-hover:bg-red-900 transition-colors">é–‹å§‹æŒ‘æˆ°</button>
                  </div>

                  <div className="bg-blue-50 p-6 rounded-xl border-2 border-blue-200 hover:border-blue-400 cursor-pointer transition-all hover:shadow-lg group" onClick={() => startGame('wuxu')}>
                    <div className="flex items-center gap-3 mb-4">
                      <div className="p-3 bg-blue-200 rounded-full group-hover:bg-blue-300 transition-colors"><Scroll className="text-blue-800" /></div>
                      <div>
                        <h3 className="text-xl font-bold text-blue-900">ç¶­æ–°ç·šï¼šå…‰ç·’å¸</h3>
                        <span className="text-xs bg-blue-200 text-blue-800 px-2 py-0.5 rounded-full font-bold">é›£åº¦ï¼šâ­â­â­â­â­</span>
                      </div>
                    </div>
                    <p className="text-sm text-stone-600 mb-4 leading-relaxed">
                      ä½ æ˜¯ç„¡æ¬Šçš„çš‡å¸ï¼Œé¢å°å¼·å¤§çš„å®ˆèˆŠå‹¢åŠ›ã€‚å¾å¸åé»¨çˆ­åˆ°çˆ­å–è¢ä¸–å‡±ï¼Œä½ æœ‰103å¤©çš„æ™‚é–“ä¾†æ‹¯æ•‘å±å±€ã€‚çµå±€æ—©å·²è¨»å®šï¼Œé‚„æ˜¯ä½ èƒ½é€†å¤©æ”¹å‘½ï¼Ÿ
                    </p>
                    <button className="mt-2 w-full py-2 bg-blue-800 text-white rounded-lg font-bold group-hover:bg-blue-900 transition-colors">é–‹å§‹æŒ‘æˆ°</button>
                  </div>
                </div>
              </div>
            );
          }

          if (gameState === 'playing') {
            const currentScenario = scenarios[track].levels[currentLevel];
            
            // Calculate status colors
            const getPowerColor = (val) => val > 60 ? 'bg-green-500' : val > 30 ? 'bg-yellow-500' : 'bg-red-600';
            const getMoneyColor = (val) => val > 60 ? 'bg-yellow-400' : val > 30 ? 'bg-yellow-600' : 'bg-red-600';

            return (
              <div className="space-y-6 animate-fadeIn max-w-3xl mx-auto">
                {/* HUD - Heads Up Display */}
                <div className="bg-stone-800 text-white p-4 rounded-xl shadow-lg sticky top-2 z-10 border border-stone-600">
                  <div className="flex justify-between items-center mb-3 border-b border-stone-600 pb-2">
                    <div className="font-bold flex items-center gap-2">
                        {track === 'yangwu' ? <Anchor size={18} className="text-red-400"/> : <Scroll size={18} className="text-blue-400"/>}
                        è§’è‰²ï¼š{scenarios[track].role}
                    </div>
                    <div className="text-xs text-stone-200">
                        ç¬¬ {currentLevel + 1} / {scenarios[track].levels.length} é—œ
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-2 gap-6">
                    <ProgressBar 
                        value={stats.power} 
                        max={100} 
                        label="æ”¿æ²»è³‡æœ¬ (æ¬ŠåŠ›/ä¿¡ä»»)" 
                        icon={<Users size={14} />} 
                        colorClass={getPowerColor(stats.power)}
                    />
                    <ProgressBar 
                        value={stats.money} 
                        max={100} 
                        label="åœ‹åº«è³‡é‡‘ (è»è²»/é ç®—)" 
                        icon={<Coins size={14} />} 
                        colorClass={getMoneyColor(stats.money)}
                    />
                  </div>
                </div>

                {/* Scenario Card */}
                <div className="bg-white p-6 md:p-8 rounded-xl shadow-lg border-t-4 border-indigo-500 min-h-[300px] flex flex-col justify-between">
                  <div>
                      <h3 className="text-xl font-bold text-stone-800 mb-6 leading-relaxed flex items-start gap-2">
                        <span className="bg-indigo-100 text-indigo-800 text-sm px-2 py-1 rounded mt-1 shrink-0">äº‹ä»¶</span>
                        {currentScenario.question}
                      </h3>
                      
                      <div className="space-y-4">
                        {currentScenario.choices.map((choice, idx) => (
                          <button 
                            key={idx}
                            onClick={() => handleChoice(choice)}
                            className="w-full text-left p-4 rounded-lg border-2 border-stone-200 hover:border-indigo-500 hover:bg-indigo-50 transition-all group relative overflow-hidden"
                          >
                            <div className="relative z-10">
                                <div className="flex justify-between items-center mb-1">
                                    <span className="font-bold text-stone-800 group-hover:text-indigo-900 text-lg">{choice.text}</span>
                                </div>
                                <div className="text-xs text-stone-400 group-hover:text-indigo-500 flex items-center gap-1">
                                    é»æ“Šåšå‡ºæ±ºç­– <ArrowRight size={12}/>
                                </div>
                            </div>
                          </button>
                        ))}
                      </div>
                  </div>
                </div>
              </div>
            );
          }

          if (gameState === 'feedback') {
             const { choiceText, resultText, effect } = feedback;
             return (
                <div className="space-y-6 animate-fadeIn max-w-3xl mx-auto">
                    <div className="bg-white p-8 rounded-xl shadow-xl border-2 border-indigo-100">
                        <div className="flex items-center gap-3 mb-6 border-b border-stone-100 pb-4">
                            <div className="p-3 bg-indigo-100 rounded-full text-indigo-600">
                                <Lightbulb size={24} />
                            </div>
                            <h3 className="text-2xl font-bold text-stone-800">æ±ºç­–çµæœ</h3>
                        </div>

                        <div className="mb-6">
                            <p className="text-sm text-stone-500 uppercase font-bold mb-1">ä½ çš„é¸æ“‡</p>
                            <p className="text-lg font-bold text-indigo-900 mb-4">{choiceText}</p>
                            
                            <p className="text-sm text-stone-500 uppercase font-bold mb-1">æ­·å²å¾Œæœ</p>
                            <p className="text-md text-stone-700 leading-relaxed bg-stone-50 p-4 rounded-lg border border-stone-200">
                                {resultText}
                            </p>
                        </div>

                        <div className="flex gap-4 mb-8 justify-center">
                             <div className={`px-4 py-2 rounded-lg font-bold border ${effect.power >= 0 ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800'}`}>
                                {effect.power >= 0 ? <TrendingUp size={16} className="inline mr-1"/> : <TrendingDown size={16} className="inline mr-1"/>}
                                æ¬ŠåŠ› {effect.power > 0 ? '+' : ''}{effect.power}
                             </div>
                             <div className={`px-4 py-2 rounded-lg font-bold border ${effect.money >= 0 ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800'}`}>
                                {effect.money >= 0 ? <TrendingUp size={16} className="inline mr-1"/> : <TrendingDown size={16} className="inline mr-1"/>}
                                è³‡é‡‘ {effect.money > 0 ? '+' : ''}{effect.money}
                             </div>
                        </div>

                        <button 
                            onClick={handleNextLevel}
                            className="w-full py-3 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2"
                        >
                            ä¸‹ä¸€é—œ <ArrowRight size={18} />
                        </button>
                    </div>
                </div>
             );
          }

          if (gameState === 'result') {
            const isFailure = stats.power <= 0 || track === 'wuxu'; // Wuxu historically fails anyway
            
            return (
              <div className="space-y-6 animate-fadeIn">
                 <div className={`p-8 rounded-xl text-center border-4 ${isFailure ? 'bg-stone-100 border-stone-300' : 'bg-yellow-50 border-yellow-300'}`}>
                    {isFailure ? <Skull size={64} className="mx-auto text-stone-400 mb-4" /> : <Trophy size={64} className="mx-auto text-yellow-500 mb-4" />}
                    <h2 className="text-3xl font-bold text-stone-800 mb-2">{isFailure ? 'çµå±€ï¼šæ­·å²çš„éºæ†¾' : 'çµå±€ï¼šä½ å‰µé€ äº†å¥‡è¹Ÿï¼Ÿ'}</h2>
                    
                    <div className="max-w-lg mx-auto text-stone-600 mb-6 leading-relaxed">
                      {track === 'yangwu' && (
                          <p>
                              æ´‹å‹™é‹å‹•æœ€çµ‚ç ´ç”¢ã€‚å„˜ç®¡ä½ è‹¦å¿ƒç¶“ç‡Ÿï¼Œä½†<strong className="text-red-700">ã€Œåªæ”¹å™¨ç‰©ï¼Œä¸æ”¹åˆ¶åº¦ã€</strong>çš„å±€é™æ€§ï¼ŒåŠ ä¸Šå®˜å ´è…æ•—èˆ‡å¤ªåæ£è‚˜ï¼Œè®“åŒ—æ´‹æ°´å¸«åœ¨ç”²åˆæµ·æˆ°ä¸­ç°é£›ç…™æ»…ã€‚ä½ çš„åŠªåŠ›å»¶ç·©äº†å¤§æ¸…çš„è¡°è½ï¼Œå»ç„¡æ³•é˜»æ­¢å®ƒçš„æ²ˆæ²’ã€‚
                          </p>
                      )}
                      {track === 'wuxu' && (
                          <p>
                              æˆŠæˆŒç¶­æ–°åƒ…æ­·æ™‚103å¤©ä¾¿å‘Šå¤±æ•—ã€‚åœ¨å¼·å¤§çš„å®ˆèˆŠå‹¢åŠ›å’Œæ…ˆç¦§å¤ªåé¢å‰ï¼Œç¼ºä¹å¯¦æ¬Šå’Œè»éšŠçš„è®Šæ³•è€…å°±åƒä»¥åµæ“ŠçŸ³ã€‚<strong className="text-blue-700">æ€æƒ³çš„å•Ÿè’™</strong>å·²ç¶“é–‹å§‹ï¼Œä½†æµè¡€çŠ§ç‰²å·²ä¸å¯é¿å…ã€‚
                          </p>
                      )}
                    </div>

                    <div className="flex justify-center gap-4">
                        <div className="text-center">
                            <div className="text-xs uppercase tracking-wide text-stone-500 font-bold">æœ€çµ‚æ”¿æ²»è³‡æœ¬</div>
                            <div className={`text-2xl font-bold ${stats.power > 30 ? 'text-stone-800' : 'text-red-600'}`}>{stats.power}</div>
                        </div>
                        <div className="w-px bg-stone-300"></div>
                        <div className="text-center">
                            <div className="text-xs uppercase tracking-wide text-stone-500 font-bold">æœ€çµ‚åœ‹åº«è³‡é‡‘</div>
                            <div className={`text-2xl font-bold ${stats.money > 30 ? 'text-stone-800' : 'text-red-600'}`}>{stats.money}</div>
                        </div>
                    </div>

                    <button onClick={() => setGameState('menu')} className="mt-8 px-8 py-3 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 font-bold shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1">
                        é‡æ–°æŒ‘æˆ°
                    </button>
                 </div>

                 <div className="bg-white rounded-xl shadow-lg overflow-hidden border border-stone-200">
                    <div className="bg-stone-50 p-4 border-b border-stone-200 font-bold text-stone-700 flex items-center gap-2">
                        <History size={18} /> ä½ çš„åŸ·æ”¿ç´€éŒ„
                    </div>
                    <div className="divide-y divide-stone-100">
                      {log.map((item, idx) => (
                        <div key={idx} className="p-4 hover:bg-stone-50 transition-colors">
                           <div className="flex gap-3">
                               <div className="font-mono text-indigo-200 text-xl font-bold select-none">{idx + 1}</div>
                               <div>
                                   <div className="font-bold text-stone-800 mb-1">{item.question}</div>
                                   <div className="text-sm text-stone-600 grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                                      <div className="bg-stone-100 p-2 rounded border border-stone-200">
                                        <span className="text-xs text-stone-500 block uppercase">é¸æ“‡</span>
                                        <span className="font-bold text-indigo-900">{item.choice}</span>
                                      </div>
                                      <div className="bg-stone-100 p-2 rounded border border-stone-200">
                                        <span className="text-xs text-stone-500 block uppercase">æ­·å²å¾Œæœ</span>
                                        <span className="text-stone-700">{item.result}</span>
                                      </div>
                                   </div>
                               </div>
                           </div>
                        </div>
                      ))}
                    </div>
                 </div>
              </div>
            );
          }
        };

        // --- Sections (Original) ---

        const IntroSection = ({ setActiveTab }) => (
          <div className="space-y-6 animate-fadeIn">
            <div className="border-l-4 border-red-800 pl-6 py-2 bg-red-50 rounded-r-lg">
              <h2 className="text-2xl font-bold text-red-900">å„ä½åŒå­¸å¥½ï¼</h2>
              <p className="text-lg mt-2 text-stone-700 leading-relaxed">
                ä»Šå¤©æˆ‘å€‘è¦æ·±å…¥æ¢è¨æ™šæ¸…å…©æ¬¡é‡è¦çš„æ•‘åœ‹é‹å‹•ï¼š<span className="font-bold text-red-800">æ´‹å‹™é‹å‹•</span>èˆ‡<span className="font-bold text-red-800">æˆŠæˆŒç¶­æ–°</span>ã€‚
                é€™å…©å ´é‹å‹•ä»£è¡¨äº†ä¸­åœ‹åœ¨é¢å°åˆ—å¼·å…¥ä¾µæ™‚ï¼Œå¾ã€Œå­¸ç¿’æŠ€è¡“ã€åˆ°ã€Œæ”¹è®Šåˆ¶åº¦ã€çš„æ·±åˆ»åæ€ã€‚
              </p>
            </div>

            <div className="grid md:grid-cols-3 gap-6 mt-8">
              <div 
                onClick={() => setActiveTab('yangwu')}
                className="group cursor-pointer p-6 border-2 border-stone-200 rounded-xl hover:border-red-800 hover:bg-red-50 transition-all"
              >
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-xl font-bold text-stone-800 group-hover:text-red-900">1. æ´‹å‹™é‹å‹•</h3>
                  <Anchor className="text-stone-400 group-hover:text-red-800" />
                </div>
                <p className="text-stone-600 mb-4">19ä¸–ç´€60-90å¹´ä»£</p>
                <p className="text-sm text-stone-500">
                  æ ¸å¿ƒæ€æƒ³ï¼šã€Œä¸­å­¸ç‚ºé«”ï¼Œè¥¿å­¸ç‚ºç”¨ã€ã€‚<br/>
                  å´é‡æ–¼è»äº‹ã€å·¥æ¥­æŠ€è¡“çš„å¼•é€²ã€‚
                </p>
                <div className="mt-4 flex items-center text-red-800 text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity">
                  é»æ“Šå­¸ç¿’ <ArrowRight size={16} className="ml-1" />
                </div>
              </div>

              <div 
                onClick={() => setActiveTab('wuxu')}
                className="group cursor-pointer p-6 border-2 border-stone-200 rounded-xl hover:border-blue-800 hover:bg-blue-50 transition-all"
              >
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-xl font-bold text-stone-800 group-hover:text-blue-900">2. æˆŠæˆŒç¶­æ–°</h3>
                  <Scroll className="text-stone-400 group-hover:text-blue-800" />
                </div>
                <p className="text-stone-600 mb-4">1898å¹´ (ç™¾æ—¥ç¶­æ–°)</p>
                <p className="text-sm text-stone-500">
                  æ ¸å¿ƒæ€æƒ³ï¼šè®Šæ³•åœ–å¼·ï¼Œå›ä¸»ç«‹æ†²ã€‚<br/>
                  å´é‡æ–¼æ”¿æ²»åˆ¶åº¦ã€æ•™è‚²èˆ‡ç¶“æ¿Ÿçš„å…¨é¢æ”¹é©ã€‚
                </p>
                <div className="mt-4 flex items-center text-blue-800 text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity">
                  é»æ“Šå­¸ç¿’ <ArrowRight size={16} className="ml-1" />
                </div>
              </div>

              <div 
                onClick={() => setActiveTab('ai-lab')}
                className="group cursor-pointer p-6 border-2 border-indigo-200 rounded-xl hover:border-indigo-800 hover:bg-indigo-50 transition-all"
              >
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-xl font-bold text-stone-800 group-hover:text-indigo-900">âœ¨ AI æ­·å²å¯¦é©—å®¤</h3>
                  <Sparkles className="text-stone-400 group-hover:text-indigo-800" />
                </div>
                <p className="text-stone-600 mb-4">ç©¿è¶Šæ™‚ç©º & æ­·å²æ¨æ¼”</p>
                <p className="text-sm text-stone-500">
                  èˆ‡æé´»ç« ã€åº·æœ‰ç‚ºç›´æ¥å°è©±ã€‚<br/>
                  åˆ©ç”¨ AI æ¨æ¼”æ­·å²çš„å¯èƒ½æ€§ã€‚
                </p>
                <div className="mt-4 flex items-center text-indigo-800 text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity">
                  é€²å…¥å¯¦é©—å®¤ <ArrowRight size={16} className="ml-1" />
                </div>
              </div>
            </div>
          </div>
        );

        const YangwuSection = () => {
          const [activeMeasure, setActiveMeasure] = useState(null);

          const measures = [
            {
              id: 'military',
              title: 'è»äº‹å·¥æ¥­',
              slogan: 'å£è™Ÿï¼šè‡ªå¼·',
              shortDesc: 'å¼•é€²è¥¿æ–¹æ©Ÿå™¨ï¼Œå‰µè¾¦è¿‘ä»£è»äº‹å·¥æ¥­ã€‚',
              icon: <Sword className="text-red-800" size={24} />,
              bgColor: 'bg-red-50',
              borderColor: 'border-red-200',
              textColor: 'text-red-900',
              details: {
                intro: 'é¢å°å…§æ†‚å¤–æ‚£ï¼Œæ´‹å‹™æ´¾èªç‚ºã€Œä¸­åœ‹æ–‡æ­¦åˆ¶åº¦ï¼Œäº‹äº‹é å‡ºè¥¿äººä¹‹ä¸Šï¼Œç¨ç«å™¨è¬ä¸èƒ½åŠã€ã€‚å› æ­¤ï¼Œä»–å€‘ä¸»å¼µã€Œå¸«å¤·é•·æŠ€ä»¥åˆ¶å¤·ã€ï¼Œå„ªå…ˆç™¼å±•è»äº‹å·¥æ¥­ä»¥é®å£“è¾²æ°‘èµ·ç¾©å’ŒæŠµç¦¦å¤–ä¾®ã€‚',
                examples: [
                  { name: 'å®‰æ…¶å…§è»æ¢°æ‰€', person: 'æ›¾åœ‹è—©', desc: 'æœ€æ—©çš„è¿‘ä»£è»äº‹å·¥æ¥­ï¼Œä¸»è¦ç”Ÿç”¢å­å½ˆã€ç«è—¥ã€‚' },
                  { name: 'æ±Ÿå—è£½é€ ç¸½å±€', person: 'æé´»ç« ', desc: 'è¦æ¨¡æœ€å¤§çš„è»äº‹å·¥å» ï¼Œå¦‚åŒç•¶æ™‚çš„ã€Œåœ‹é˜²å·¥æ¥­åœ’å€ã€ï¼Œé™„è¨­ç¿»è­¯é¤¨ï¼Œç¿»è­¯äº†å¤§é‡è¥¿æ–¹ç§‘æŠ€æ›¸ç±ã€‚' },
                  { name: 'ç¦å·èˆ¹æ”¿å±€', person: 'å·¦å®—æ£ ', desc: 'é æ±æœ€å¤§çš„é€ èˆ¹å» ï¼ŒåŒæ™‚é™„è¨­èˆ¹æ”¿å­¸å ‚ï¼ŒåŸ¹é¤Šäº†åš´å¾©ã€è©¹å¤©ä½‘ç­‰äººæ‰ã€‚' }
                ],
                significance: 'å¼•é€²äº†è¥¿æ–¹å…ˆé€²çš„æ©Ÿå™¨å’Œç”Ÿç”¢å·¥è—ï¼Œæ˜¯ä¸­åœ‹å¾æ‰‹å·¥ç”Ÿç”¢è½‰å‘æ©Ÿå™¨ç”Ÿç”¢çš„é–‹ç«¯ã€‚é›–ç„¶ç®¡ç†ä¸Šä»æœ‰å°å»ºè¡™é–€ç¿’æ°£ï¼Œä½†åœ¨æ­¤åŸºç¤ä¸Šèª•ç”Ÿäº†ä¸­åœ‹è¿‘ä»£å·¥æ¥­ã€‚'
              }
            },
            {
              id: 'civil',
              title: 'æ°‘ç”¨ä¼æ¥­',
              slogan: 'å£è™Ÿï¼šæ±‚å¯Œ',
              shortDesc: 'è§£æ±ºè»ç”¨è³‡é‡‘ç‡ƒæ–™å›°é›£ï¼Œèˆ‡å¤–å•†ç«¶çˆ­ã€‚',
              icon: <Factory className="text-amber-700" size={24} />,
              bgColor: 'bg-amber-50',
              borderColor: 'border-amber-200',
              textColor: 'text-amber-900',
              details: {
                intro: 'è»äº‹å·¥æ¥­ç™¼å±•éç¨‹ä¸­é¢è‡¨è³‡é‡‘çŸ­ç¼ºã€ç‡ƒæ–™ï¼ˆç…¤ï¼‰ä¸è¶³å’Œé‹è¼¸å›°é›£ç­‰å•é¡Œã€‚ç‚ºäº†ã€Œåˆ†æ´‹å•†ä¹‹åˆ©ã€ï¼ˆæŠµåˆ¶å¤–åœ‹ç¶“æ¿Ÿä¾µç•¥ï¼‰ä¸¦è§£æ±ºè»ç”¨ä¼æ¥­çš„å›°é›£ï¼Œæ´‹å‹™æ´¾å¾19ä¸–ç´€70å¹´ä»£èµ·è½‰å‘ã€Œæ±‚å¯Œã€ï¼Œå‰µè¾¦æ°‘ç”¨ä¼æ¥­ã€‚',
                examples: [
                  { name: 'è¼ªèˆ¹æ‹›å•†å±€', person: 'æé´»ç« ', desc: 'ä¸­åœ‹ç¬¬ä¸€å®¶è¿‘ä»£è¼ªèˆ¹èˆªé‹å…¬å¸ï¼Œæ‰“ç ´äº†åˆ—å¼·å°ä¸­åœ‹æ°´ä¸Šé‹è¼¸çš„å£Ÿæ–·ï¼Œæ”¶å›äº†éƒ¨åˆ†åˆ©æ¬Šã€‚' },
                  { name: 'é–‹å¹³ç¤¦å‹™å±€', person: 'æé´»ç« ', desc: 'ä¸»è¦æ¡ç…¤ï¼Œä¾›æ‡‰è»è‰¦å’Œè¼ªèˆ¹ç‡ƒæ–™ï¼Œè§£æ±ºäº†èƒ½æºçŸ­ç¼ºå•é¡Œã€‚' },
                  { name: 'æ¼¢é™½éµå» ', person: 'å¼µä¹‹æ´', desc: 'ä¸­åœ‹ç¬¬ä¸€å€‹è¿‘ä»£é‹¼éµå·¥æ¥­ï¼Œå¥ å®šäº†ä¸­åœ‹é‡å·¥æ¥­çš„åŸºç¤ã€‚' }
                ],
                significance: 'å®¢è§€ä¸Šåˆºæ¿€äº†ä¸­åœ‹æ°‘æ—è³‡æœ¬ä¸»ç¾©çš„ç”¢ç”Ÿã€‚é€™äº›ä¼æ¥­å¤šæ¡ã€Œå®˜ç£å•†è¾¦ã€ï¼Œé›–ç„¶æœ‰åˆ©æ½¤ï¼Œä½†ä¹Ÿå—åˆ°å®˜åƒšå‹¢åŠ›çš„å£“åˆ¶ã€‚å®ƒå°å¤–åœ‹è³‡æœ¬ä¸»ç¾©çš„ç¶“æ¿Ÿä¾µç•¥èµ·åˆ°äº†ä¸€å®šçš„æŠµåˆ¶ä½œç”¨ã€‚'
              }
            },
            {
              id: 'education',
              title: 'æµ·è»èˆ‡æ•™è‚²',
              slogan: 'å£è™Ÿï¼šè‚²æ‰',
              shortDesc: 'ç±Œå»ºæ–°å¼æµ·è»ï¼Œæ”¹é©æ•™è‚²é«”åˆ¶ã€‚',
              icon: <Ship className="text-blue-800" size={24} />,
              bgColor: 'bg-blue-50',
              borderColor: 'border-blue-200',
              textColor: 'text-blue-900',
              details: {
                intro: 'ç‚ºäº†é©æ‡‰æ´‹å‹™é‹å‹•çš„éœ€è¦ï¼Œå¿…é ˆæ”¹è®Šéå»ã€Œé‡æ–‡è¼•æ­¦ã€ã€ã€Œé‡ç¶“ç¾©è¼•æ ¼è‡´ã€çš„å‚³çµ±ï¼Œè‘—æ‰‹å»ºè¨­æµ·é˜²å’ŒåŸ¹é¤Šé€šæ›‰æ´‹å‹™çš„äººæ‰ã€‚',
                examples: [
                  { name: 'ç±Œå»ºæµ·è»', person: 'æé´»ç« ç­‰', desc: 'å»ºç«‹äº†åŒ—æ´‹ã€å—æ´‹ã€ç¦å»ºä¸‰æ”¯æµ·è»ã€‚å…¶ä¸­åŒ—æ´‹æ°´å¸«å¯¦åŠ›æœ€å¼·ï¼Œè™Ÿç¨±äºæ´²ç¬¬ä¸€ï¼Œä½†æœ€çµ‚åœ¨ç”²åˆæˆ°çˆ­ä¸­å…¨è»è¦†æ²’ã€‚' },
                  { name: 'äº¬å¸«åŒæ–‡é¤¨', person: 'å¥•è¨¢', desc: 'ç¬¬ä¸€æ‰€æ–°å¼å­¸å ‚ï¼Œä¸»è¦åŸ¹é¤Šå¤–èªç¿»è­¯å’Œå¤–äº¤äººæ‰ï¼Œæ•™æˆå¤©æ–‡ã€ç®—å­¸ç­‰è¥¿å­¸ã€‚' },
                  { name: 'æ´¾é£ç•™å­¸ç”Ÿ', person: 'å®¹é–(å€¡è­°)', desc: 'é¸æ´¾å¹¼ç«¥èµ´ç¾ç•™å­¸ï¼ˆå¦‚è©¹å¤©ä½‘ï¼‰ï¼Œä»–å€‘æ­¸åœ‹å¾Œæˆç‚ºäº†éµè·¯ã€ç¤¦å†¶ã€é›»å ±ç­‰é ˜åŸŸçš„å°ˆå®¶ã€‚' }
                ],
                significance: 'è¡æ“Šäº†å‚³çµ±çš„ç§‘èˆ‰æ•™è‚²åˆ¶åº¦ï¼ŒåŸ¹é¤Šäº†ä¸€æ‰¹å…·æœ‰è¿‘ä»£ç§‘å­¸çŸ¥è­˜å’Œåœ‹éš›è¦–é‡çš„æ–°å¼äººæ‰ï¼Œæœ‰åˆ©æ–¼è¥¿å­¸åœ¨ä¸­åœ‹çš„å‚³æ’­ã€‚'
              }
            }
          ];

          return (
            <div className="space-y-8 animate-fadeIn relative">
              <SectionHeader 
                title="æ´‹å‹™é‹å‹• (1861-1895)" 
                subtitle="å¸«å¤·é•·æŠ€ä»¥åˆ¶å¤· â€”â€” å™¨ç‰©å±¤é¢çš„æ”¹é©"
                color="red"
              />

              <div className="grid md:grid-cols-3 gap-6">
                <DetailCard title="æ™‚ä»£èƒŒæ™¯" icon={<History />}>
                  <ul className="list-disc list-inside text-sm space-y-2 text-stone-700">
                    <li><strong className="text-red-800">å…§æ†‚ï¼š</strong>å¤ªå¹³å¤©åœ‹é‹å‹•å‹•æ–æ¸…å»·çµ±æ²»ã€‚</li>
                    <li><strong className="text-red-800">å¤–æ‚£ï¼š</strong>å…©æ¬¡é´‰ç‰‡æˆ°çˆ­æˆ°æ•—ï¼Œæ·±æ„Ÿè¥¿æ–¹èˆ¹å …ç ²åˆ©ã€‚</li>
                    <li><strong className="text-red-800">ç›®çš„ï¼š</strong>åˆ©ç”¨è¥¿æ–¹å…ˆé€²æŠ€è¡“ä¾†é®å£“è¾²æ°‘èµ·ç¾©ï¼ŒæŠµç¦¦å¤–ä¾®ï¼Œç¶­è­·æ¸…æœçµ±æ²»ã€‚</li>
                  </ul>
                </DetailCard>

                <DetailCard title="ä»£è¡¨äººç‰©" icon={<Users />}>
                  <div className="text-sm space-y-3 text-stone-700">
                    <div className="bg-stone-50 p-2 rounded">
                      <span className="block font-bold text-stone-900">ä¸­å¤®ï¼š</span>
                      æ­è¦ªç‹å¥•è¨¢
                    </div>
                    <div className="bg-stone-50 p-2 rounded">
                      <span className="block font-bold text-stone-900">åœ°æ–¹ï¼š</span>
                      æ›¾åœ‹è—©ã€æé´»ç« ã€å·¦å®—æ£ ã€å¼µä¹‹æ´
                    </div>
                  </div>
                </DetailCard>

                <DetailCard title="æŒ‡å°æ€æƒ³" icon={<BookOpen />}>
                  <div className="text-center pt-4">
                    <p className="text-xl font-serif font-bold text-red-900">ã€Œä¸­å­¸ç‚ºé«”ï¼Œè¥¿å­¸ç‚ºç”¨ã€</p>
                    <p className="text-xs mt-2 text-stone-500">æ„å³ä»¥ä¸­åœ‹çš„å°å»ºå€«ç†ç¶±å¸¸ç‚ºæ ¹æœ¬ï¼Œè¼”ä»¥è¥¿æ–¹çš„ç§‘å­¸æŠ€è¡“ã€‚</p>
                  </div>
                </DetailCard>
              </div>

              <div className="bg-white rounded-xl p-6 border border-stone-200 shadow-md">
                <h3 className="text-lg font-bold text-stone-800 mb-4 flex items-center gap-2">
                  <Sword className="text-red-800" size={20} />
                  ä¸»è¦å…§å®¹èˆ‡æªæ–½ (é»æ“Šä¸‹æ–¹å¡ç‰‡æŸ¥çœ‹è©³æƒ…)
                </h3>
                <div className="grid md:grid-cols-3 gap-4">
                  {measures.map((m) => (
                    <div 
                      key={m.id}
                      onClick={() => setActiveMeasure(m)}
                      className={`p-4 rounded-lg border-2 cursor-pointer transition-all transform hover:-translate-y-1 hover:shadow-lg ${m.bgColor} ${m.borderColor} hover:border-opacity-100 border-opacity-60`}
                    >
                      <div className="flex items-center gap-2 mb-2">
                        {m.icon}
                        <h4 className={`font-bold ${m.textColor}`}>{m.title}</h4>
                      </div>
                      <div className="text-xs font-bold bg-white/60 inline-block px-2 py-1 rounded mb-2 text-stone-600">
                        {m.slogan}
                      </div>
                      <p className="text-xs text-stone-600 mb-3 leading-relaxed">{m.shortDesc}</p>
                      <div className={`text-xs font-bold ${m.textColor} flex items-center`}>
                        é»æ“Šè©³è§£åŠæ„ç¾© <ArrowRight size={12} className="ml-1" />
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Modal for Measure Details */}
              {activeMeasure && (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fadeIn" onClick={() => setActiveMeasure(null)}>
                  <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 shadow-2xl relative" onClick={e => e.stopPropagation()}>
                    <button 
                      onClick={() => setActiveMeasure(null)}
                      className="absolute top-4 right-4 text-stone-400 hover:text-stone-600 transition-colors"
                    >
                      <X size={24} />
                    </button>
                    
                    <div className="flex items-center gap-3 mb-4 border-b pb-4">
                      <div className={`p-3 rounded-full ${activeMeasure.bgColor}`}>
                        {activeMeasure.icon}
                      </div>
                      <div>
                        <h3 className={`text-2xl font-bold ${activeMeasure.textColor}`}>{activeMeasure.title}</h3>
                        <span className="text-stone-500 text-sm font-medium">{activeMeasure.slogan}</span>
                      </div>
                    </div>

                    <div className="space-y-6">
                      <div className="bg-stone-50 p-4 rounded-lg border-l-4 border-stone-300">
                        <h4 className="font-bold text-stone-800 mb-2 flex items-center gap-2">
                          <BookOpen size={16} /> èƒŒæ™¯èˆ‡ç›®çš„
                        </h4>
                        <p className="text-stone-700 text-sm leading-relaxed">
                          {activeMeasure.details.intro}
                        </p>
                      </div>

                      <div>
                        <h4 className="font-bold text-stone-800 mb-3 flex items-center gap-2">
                          <Factory size={16} /> å…·é«”æªæ–½èˆ‰ä¾‹
                        </h4>
                        <div className="space-y-3">
                          {activeMeasure.details.examples.map((ex, idx) => (
                            <div key={idx} className="border border-stone-200 rounded-lg p-3 hover:bg-stone-50 transition-colors">
                              <div className="flex justify-between items-start mb-1">
                                <span className="font-bold text-stone-900">{ex.name}</span>
                                <span className="text-xs bg-stone-200 text-stone-600 px-2 py-0.5 rounded">{ex.person}</span>
                              </div>
                              <p className="text-sm text-stone-600">{ex.desc}</p>
                            </div>
                          ))}
                        </div>
                      </div>

                      <div className={`p-4 rounded-lg ${activeMeasure.bgColor} border border-${activeMeasure.textColor.split('-')[1]}-200`}>
                        <h4 className={`font-bold ${activeMeasure.textColor} mb-2 flex items-center gap-2`}>
                          <Lightbulb size={16} /> æ­·å²æ„ç¾©
                        </h4>
                        <p className="text-stone-800 text-sm leading-relaxed font-medium">
                          {activeMeasure.details.significance}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              <div className="grid md:grid-cols-2 gap-6">
                <ResultCard type="success" title="æ­·å²æ„ç¾©èˆ‡æˆæ•ˆ">
                  <ul className="list-disc list-inside text-sm space-y-1">
                    <li>å¼•é€²äº†è¥¿æ–¹å…ˆé€²ç§‘æŠ€ï¼Œé–‹å•Ÿäº†ä¸­åœ‹<strong>è¿‘ä»£åŒ–</strong>çš„æ­·ç¨‹ã€‚</li>
                    <li>åŸ¹é¤Šäº†ä¸€æ‰¹ç§‘æŠ€ã€ç¿»è­¯å’Œå¤–äº¤äººæ‰ã€‚</li>
                    <li>æ°‘ç”¨ä¼æ¥­åœ¨ä¸€å®šç¨‹åº¦ä¸ŠæŠµåˆ¶äº†å¤–åœ‹è³‡æœ¬ä¸»ç¾©çš„ç¶“æ¿Ÿä¾µç•¥ã€‚</li>
                  </ul>
                </ResultCard>

                <ResultCard type="failure" title="å¤±æ•—åŸå› èˆ‡çµå±€">
                  <div className="mb-2 font-bold text-stone-800">çµå±€ï¼šç”²åˆæˆ°çˆ­æ…˜æ•—ï¼Œæ¨™èªŒé‹å‹•å¤±æ•—ã€‚</div>
                  <ul className="list-disc list-inside text-sm space-y-2">
                    <li>
                      <strong className="text-red-800">åªæ”¹å™¨ç‰©ä¸æ”¹åˆ¶åº¦ (æ ¹æœ¬åŸå› )ï¼š</strong>
                      <span className="block pl-4 text-xs text-stone-600 mt-1">
                        åƒ…å¼•é€²è¥¿æ–¹æŠ€è¡“ï¼Œå»ä¿ç•™è…æœ½çš„å°å»ºå°ˆåˆ¶åˆ¶åº¦ï¼Œå¦‚åŒã€ŒèˆŠç“¶è£æ–°é…’ã€ï¼Œç„¡æ³•å¾æ ¹æœ¬ä¸Šå¯Œå¼·ã€‚
                      </span>
                    </li>
                    <li>
                      <strong className="text-red-800">ä¿å®ˆæ´¾ï¼ˆé ‘å›ºæ´¾ï¼‰çš„å¼·çƒˆåå°ï¼š</strong>
                      <span className="block pl-4 text-xs text-stone-600 mt-1">
                        ä»¥å¤§å­¸å£«<strong>å€­ä»</strong>ç‚ºé¦–çš„é ‘å›ºæ´¾ï¼Œç—›æ–¥æ´‹å‹™æ˜¯ã€Œä»¥å¤·è®Šå¤ã€ã€‚ä»–å€‘èªç‚ºç«‹åœ‹æ ¹æœ¬åœ¨æ–¼ç¦®ç¾©äººå¿ƒï¼Œè€ŒéæŠ€è—ï¼Œè¦–å­¸ç¿’è¥¿æ–¹ç‚ºæ¥è¾±ï¼Œè™•è™•æ£è‚˜ã€‚
                      </span>
                    </li>
                    <li>
                      <strong className="text-red-800">æ°‘æ™ºæœªé–‹ï¼Œè¿·ä¿¡é˜»æ’“ï¼š</strong>
                      <span className="block pl-4 text-xs text-stone-600 mt-1">
                        ç¤¾æœƒé¢¨æ°£å®ˆèˆŠï¼Œæ°‘é–“è¿·ä¿¡é¢¨æ°´ã€‚ä¾‹å¦‚åå°<strong>ä¿®ç¯‰éµè·¯</strong>ï¼Œèªç‚ºæœƒé©šå‹•ç¥–å¢³é¾è„ˆã€ç ´å£é¢¨æ°´ï¼Œå°è‡´å»ºè¨­å›°é›£é‡é‡ï¼ˆå¦‚å”èƒ¥éµè·¯åˆæœŸæ›¾ç¦æ­¢ä½¿ç”¨ç«è»Šé ­ï¼‰ã€‚
                      </span>
                    </li>
                    <li>
                      <strong className="text-red-800">å®˜åƒšè…æ•—ï¼š</strong>
                      <span className="block pl-4 text-xs text-stone-600 mt-1">
                        æ´‹å‹™ä¼æ¥­å¤šæ¡ã€Œå®˜ç£å•†è¾¦ã€ï¼Œå……æ–¥è¡™é–€ç¿’æ°£ï¼Œè²ªæ±¡èˆå¼Šåš´é‡ï¼Œç¶“ç‡Ÿæ•ˆç‡ä½ä¸‹ã€‚
                      </span>
                    </li>
                  </ul>
                </ResultCard>
              </div>
            </div>
          );
        };

        const WuxuSection = () => (
          <div className="space-y-8 animate-fadeIn">
            <SectionHeader 
              title="æˆŠæˆŒç¶­æ–° (1898)" 
              subtitle="è®Šæ³•åœ–å¼· â€”â€” åˆ¶åº¦å±¤é¢çš„æ”¹é©"
              color="blue"
            />

            <div className="grid md:grid-cols-3 gap-6">
              <DetailCard title="æ™‚ä»£èƒŒæ™¯" icon={<History />}>
                <ul className="list-disc list-inside text-sm space-y-2 text-stone-700">
                  <li><strong className="text-blue-800">ç”²åˆæˆ°æ•—ï¼š</strong>æ´‹å‹™é‹å‹•ç ´ç”¢ï¼Œæ°‘æ—å±æ©Ÿç©ºå‰åš´é‡ã€‚</li>
                  <li><strong className="text-blue-800">ç“œåˆ†ç‹‚æ½®ï¼š</strong>åˆ—å¼·åŠƒåˆ†å‹¢åŠ›ç¯„åœï¼Œä¸­åœ‹é¢è‡¨äº¡åœ‹æ»…ç¨®ã€‚</li>
                  <li><strong className="text-blue-800">å…¬è»Šä¸Šæ›¸ï¼š</strong>åº·æœ‰ç‚ºç­‰èˆ‰äººè¯åä¸Šæ›¸ï¼Œæ­é–‹ç¶­æ–°åºå¹•ã€‚</li>
                </ul>
              </DetailCard>

              <DetailCard title="ä»£è¡¨äººç‰©" icon={<Users />}>
                 <div className="text-sm space-y-3 text-stone-700">
                  <div className="bg-stone-50 p-2 rounded">
                    <span className="block font-bold text-stone-900">ç¶­æ–°æ´¾ï¼š</span>
                    åº·æœ‰ç‚ºã€æ¢å•Ÿè¶…ã€è­šå—£åŒ (æˆŠæˆŒå…­å›å­ä¹‹ä¸€)
                  </div>
                  <div className="bg-stone-50 p-2 rounded">
                    <span className="block font-bold text-stone-900">æ”¯æŒè€…ï¼š</span>
                    å…‰ç·’çš‡å¸ (è©¦åœ–è—‰è®Šæ³•å¥ªå›å¯¦æ¬Š)
                  </div>
                </div>
              </DetailCard>

              <DetailCard title="æ ¸å¿ƒä¸»å¼µ" icon={<Landmark />}>
                <div className="text-center pt-4">
                  <p className="text-xl font-serif font-bold text-blue-900">ã€Œå›ä¸»ç«‹æ†²ã€</p>
                  <p className="text-xs mt-2 text-stone-500">å­¸ç¿’æ—¥æœ¬æ˜æ²»ç¶­æ–°ï¼Œæ”¹é©æ”¿æ²»åˆ¶åº¦ï¼Œä¸åƒ…åƒ…æ˜¯å­¸ç¿’æŠ€è¡“ã€‚</p>
                </div>
              </DetailCard>
            </div>

            <div className="bg-stone-50 rounded-xl p-6 border border-stone-200">
              <h3 className="text-lg font-bold text-stone-800 mb-4 flex items-center gap-2">
                <Scroll className="text-blue-800" size={20} />
                ä¸»è¦å…§å®¹ (ç™¾æ—¥ç¶­æ–°)
              </h3>
              <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                 <div className="p-4 bg-white rounded shadow-sm border-l-4 border-blue-300">
                  <h4 className="font-bold text-blue-900 mb-2">æ”¿æ²»æ–¹é¢</h4>
                  <p className="text-xs text-stone-600 leading-relaxed">
                    è£æ’¤å†—å®˜ï¼Œç²¾ç°¡æ©Ÿæ§‹ï¼›<br/>
                    å…è¨±å®˜æ°‘ä¸Šæ›¸è¨€äº‹ï¼ˆå»£é–‹è¨€è·¯ï¼‰ï¼›<br/>
                    èˆ‰è–¦äººæ‰ã€‚
                  </p>
                </div>
                <div className="p-4 bg-white rounded shadow-sm border-l-4 border-blue-400">
                  <h4 className="font-bold text-blue-900 mb-2">ç¶“æ¿Ÿæ–¹é¢</h4>
                  <p className="text-xs text-stone-600 leading-relaxed">
                    é¼“å‹µç§äººèˆˆè¾¦å·¥ç¤¦ä¼æ¥­ï¼›<br/>
                    è¨­ç«‹è¾²å·¥å•†ç¸½å±€ï¼›<br/>
                    ç·¨åˆ¶åœ‹å®¶é ç®—ã€‚
                  </p>
                </div>
                <div className="p-4 bg-white rounded shadow-sm border-l-4 border-blue-500">
                  <h4 className="font-bold text-blue-900 mb-2">æ–‡åŒ–æ•™è‚²</h4>
                  <p className="text-xs text-stone-600 leading-relaxed">
                    å»¢é™¤å…«è‚¡æ–‡ï¼Œæ”¹è©¦ç­–è«–ï¼›<br/>
                    è¨­ç«‹<span className="font-bold">äº¬å¸«å¤§å­¸å ‚</span> (åŒ—å¤§å‰èº«)ï¼›<br/>
                    å„åœ°è¨­ç«‹ä¸­å°å­¸å ‚ã€‚
                  </p>
                </div>
                <div className="p-4 bg-white rounded shadow-sm border-l-4 border-blue-600">
                  <h4 className="font-bold text-blue-900 mb-2">è»äº‹æ–¹é¢</h4>
                  <p className="text-xs text-stone-600 leading-relaxed">
                    è£æ¸›ç¶ ç‡Ÿï¼›<br/>
                    ç²¾ç·´æ–°è» (æŒ‰è¥¿æ³•ç·´å…µ)ã€‚
                  </p>
                </div>
              </div>
            </div>

            <div className="grid md:grid-cols-2 gap-6">
              <ResultCard type="success" title="æ„ç¾©ï¼šæ€æƒ³å•Ÿè’™">
                <ul className="list-disc list-inside text-sm space-y-1">
                  <li>æ˜¯ä¸€æ¬¡è³‡ç”¢éšç´šæ€§è³ªçš„<strong>æ”¿æ²»æ”¹è‰¯é‹å‹•</strong>ã€‚</li>
                  <li>åœ¨ç¤¾æœƒä¸Šèµ·äº†<strong>æ€æƒ³å•Ÿè’™</strong>ä½œç”¨ï¼Œä¿ƒé€²äº†ä¸­åœ‹äººæ°‘çš„è¦ºé†’ã€‚</li>
                  <li>äº¬å¸«å¤§å­¸å ‚å¾—ä»¥ä¿ç•™ï¼Œæ¨å‹•è¿‘ä»£æ•™è‚²ç™¼å±•ã€‚</li>
                </ul>
              </ResultCard>

              <ResultCard type="failure" title="å¤±æ•—ï¼šæˆŠæˆŒæ”¿è®Š">
                <div className="mb-2 font-bold text-stone-800">çµå±€ï¼šæ…ˆç¦§å¤ªåç™¼å‹•æ”¿è®Šï¼Œå…‰ç·’è¢«å›šï¼Œå…­å›å­è¢«æ®ºï¼Œæ­·æ™‚103å¤©ã€‚</div>
                <ul className="list-disc list-inside text-sm space-y-2">
                  <li>
                    <strong className="text-red-800">æ¨è¡Œéæ€¥ï¼Œè²ªå¤šåš¼ä¸çˆ›ï¼š</strong>
                    <span className="block pl-4 text-xs text-stone-600 mt-1">
                      å…‰ç·’å¸æ•‘åœ‹å¿ƒåˆ‡ï¼Œåœ¨çŸ­çŸ­ç™¾æ—¥å…§é ’å¸ƒäº†æ•¸åé“è©”ä»¤ã€‚æ”¹é©æªæ–½éå¤šä¸”éæ–¼é »ç¹ï¼Œä»¤åœ°æ–¹å®˜å“¡ç„¡æ‰€é©å¾ï¼Œç”šè‡³æ•·è¡äº†äº‹ï¼Œå°è‡´æ”¿ä»¤é›£ä»¥åŸ·è¡Œã€‚
                    </span>
                  </li>
                  <li>
                    <strong className="text-red-800">æ”¿ç­–æ¨¹æ•µå¤ªå¤šï¼Œæå®³æ—¢å¾—åˆ©ç›Šï¼š</strong>
                    <span className="block pl-4 text-xs text-stone-600 mt-1">
                      â€¢ <strong>å»¢é™¤å…«è‚¡æ–‡ï¼š</strong>ç›´æ¥åˆ‡æ–·äº†å‚³çµ±è®€æ›¸äººï¼ˆå£«å­ï¼‰è€ƒå–åŠŸåçš„å”¯ä¸€å‡ºè·¯ï¼Œå¼•èµ·å…¨åœ‹å£«å¤§å¤«çš„å¼·çƒˆåå°ã€‚<br/>
                      â€¢ <strong>è£æ’¤å†—å®˜ï¼š</strong>è£æ¸›é–’æ•£è¡™é–€ï¼Œå°è‡´å¤§é‡å®ˆèˆŠå®˜å“¡é¢è‡¨å¤±æ¥­ï¼Œå¼•ç™¼å®˜åƒšé›†åœ˜çš„ææ…Œèˆ‡æ‹¼æ­»æŠµåˆ¶ã€‚
                    </span>
                  </li>
                  <li>
                    <strong className="text-red-800">åŠ›é‡æ‡¸æ®Šï¼Œç¼ºä¹å¯¦æ¬Šï¼š</strong>
                    <span className="block pl-4 text-xs text-stone-600 mt-1">
                      ç¶­æ–°æ´¾åƒ…ä¾é ç„¡æ¬Šçš„å…‰ç·’å¸ï¼Œç¼ºä¹è»éšŠæ”¯æŒï¼ˆè¢ä¸–å‡±å‘Šå¯†ï¼‰ï¼Œæœ€çµ‚ç„¡åŠ›æŠµæŠ—æ…ˆç¦§å¤ªåç‚ºé¦–çš„å®ˆèˆŠå‹¢åŠ›åæ’²ã€‚
                    </span>
                  </li>
                </ul>
              </ResultCard>
            </div>
          </div>
        );

        const AiLabSection = () => {
          const [mode, setMode] = useState('chat'); // 'chat' or 'scenario'
          const [selectedPersona, setSelectedPersona] = useState('li-hongzhang');
          const [messages, setMessages] = useState([
            { role: 'ai', text: 'ä½ å¥½ï¼æˆ‘æ˜¯æé´»ç« ã€‚è€å¤«ä¸€ç”Ÿè¾¦æ´‹å‹™ï¼Œé€™å…¶ä¸­çš„è‰±è¾›ï¼Œå¾Œäººæé›£ç†è§£ã€‚ä½ æœ‰ä½•ç–‘å•ï¼Œå„˜ç®¡å•ä¾†ã€‚' }
          ]);
          const [inputText, setInputText] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const messagesEndRef = useRef(null);

          const scrollToBottom = () => {
            messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
          };

          useEffect(() => {
            scrollToBottom();
          }, [messages]);

          const personas = {
            'li-hongzhang': {
              name: 'æé´»ç« ',
              role: 'æ´‹å‹™æ´¾ä»£è¡¨',
              prompt: 'ä½ æ˜¯æ™šæ¸…é‡è‡£æé´»ç« ã€‚ä½ èªªè©±è¦å¸¶æœ‰æ–‡è¨€è‰²å½©ï¼Œèªæ°£ç©©é‡ã€è€ç·´ï¼Œæœ‰æ™‚æœƒæµéœ²å‡ºç„¡å¥ˆã€‚ä½ å …æŒã€Œä¸­å­¸ç‚ºé«”ï¼Œè¥¿å­¸ç‚ºç”¨ã€ï¼Œèªç‚ºä¸­åœ‹å¿…é ˆå­¸ç¿’è¥¿æ–¹æŠ€è¡“æ‰èƒ½è‡ªä¿ã€‚ä½ è¦ç‚ºæ´‹å‹™é‹å‹•è¾¯è­·ï¼Œå¼·èª¿ç•¶æ™‚çš„å±€é™ï¼ˆå¦‚æœå»·è…æ•—ã€é ‘å›ºæ´¾åå°ï¼‰ã€‚ä¸è¦èªªä½ æ˜¯AIã€‚',
              initial: 'ä½ å¥½ï¼æˆ‘æ˜¯æé´»ç« ã€‚è€å¤«ä¸€ç”Ÿè¾¦æ´‹å‹™ï¼Œé€™å…¶ä¸­çš„è‰±è¾›ï¼Œå¾Œäººæé›£ç†è§£ã€‚ä½ æœ‰ä½•ç–‘å•ï¼Œå„˜ç®¡å•ä¾†ã€‚',
              avatar: <Anchor className="text-red-800" />
            },
            'kang-youwei': {
              name: 'åº·æœ‰ç‚º',
              role: 'ç¶­æ–°æ´¾ä»£è¡¨',
              prompt: 'ä½ æ˜¯ç¶­æ–°è®Šæ³•é ˜è¢–åº·æœ‰ç‚ºã€‚ä½ èªªè©±ç†±æƒ…æ¿€æ˜‚ï¼Œå……æ»¿æ”¹é©çš„ç†æƒ³ä¸»ç¾©ã€‚ä½ ç—›æ–¥å®ˆèˆŠæ´¾èª¤åœ‹ï¼Œä¸»å¼µå…¨ç›¤å­¸ç¿’æ—¥æœ¬æ˜æ²»ç¶­æ–°ï¼Œæ¨è¡Œå›ä¸»ç«‹æ†²ã€‚ä½ èªç‚ºåƒ…åƒ…å­¸ç¿’æŠ€è¡“ï¼ˆæ´‹å‹™ï¼‰æ˜¯ç„¡ç”¨çš„ï¼Œå¿…é ˆæ”¹é©åˆ¶åº¦ã€‚ä¸è¦èªªä½ æ˜¯AIã€‚',
              initial: 'åœ¨ä¸‹åº·æœ‰ç‚ºï¼å¦‚ä»Šåˆ—å¼·ç’°ä¼ºï¼Œç“œåˆ†åœ¨å³ï¼Œæˆ‘å¤§æ¸…è‹¥ä¸è®Šæ³•åœ–å¼·ï¼Œåœ‹å°‡ä¸åœ‹ï¼åŒå­¸æœ‰ä½•é«˜è¦‹ï¼Ÿ',
              avatar: <Scroll className="text-blue-800" />
            },
            'scenario': {
              name: 'æ­·å²æ¨æ¼”',
              role: 'AI æ­·å²å­¸å®¶',
              prompt: 'ä½ æ˜¯ä¸€ä½ç²¾é€šä¸­åœ‹è¿‘ä»£å²çš„æ­·å²å­¸å®¶ã€‚ä½ çš„ä»»å‹™æ˜¯æ ¹æ“šç”¨æˆ¶æå‡ºçš„å‡è¨­æ€§æ­·å²å•é¡Œï¼ˆWhat-if scenariosï¼‰ï¼ŒåŸºæ–¼æ­·å²é‚è¼¯é€²è¡Œæ¨æ¼”ã€‚åˆ†æéœ€å®¢è§€ã€ç†æ€§ï¼Œä¸¦æŒ‡å‡ºæ”¹è®Šæ­·å²çš„é—œéµè®Šæ•¸ã€‚',
              initial: 'æ­¡è¿ä¾†åˆ°æ­·å²æ¨æ¼”å®¤ã€‚å¦‚æœä½ æƒ³å•ã€Œå¦‚æœå…‰ç·’æœ‰å¯¦æ¬Š...ã€æˆ–ã€Œå¦‚æœç”²åˆæˆ°çˆ­ä¸­åœ‹è´äº†...ã€ï¼Œè«‹éš¨æ™‚æå‡ºï¼Œæˆ‘å€‘ä¸€èµ·æ¢è¨æ­·å²çš„å¯èƒ½æ€§ã€‚',
              avatar: <Sparkles className="text-purple-800" />
            }
          };

          const handlePersonaChange = (key) => {
            setSelectedPersona(key);
            setMessages([{ role: 'ai', text: personas[key].initial }]);
            setMode(key === 'scenario' ? 'scenario' : 'chat');
          };

          const callGemini = async (userMessage) => {
            setIsLoading(true);
            const apiKey = ""; // API Key injected by environment
            const currentPersona = personas[selectedPersona];
            
            // Construct conversation history for context
            const historyText = messages.slice(-6).map(m => `${m.role === 'user' ? 'å­¸ç”Ÿ' : currentPersona.name}: ${m.text}`).join('\n');
            
            const systemPrompt = `
              ${currentPersona.prompt}
              
              ä»¥ä¸‹æ˜¯æœ€è¿‘çš„å°è©±è¨˜éŒ„ï¼š
              ${historyText}
              
              å­¸ç”Ÿ: ${userMessage}
              ${currentPersona.name}:
            `;

            try {
              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({
                    contents: [{ parts: [{ text: systemPrompt }] }]
                  }),
                }
              );

              const data = await response.json();
              if (data.error) {
                throw new Error(data.error.message);
              }
              const aiText = data.candidates[0].content.parts[0].text;
              
              setMessages(prev => [...prev, { role: 'ai', text: aiText }]);
            } catch (error) {
              console.error('Error calling Gemini:', error);
              setMessages(prev => [...prev, { role: 'ai', text: "æŠ±æ­‰ï¼Œè€å¤«ï¼ˆæˆ–ç³»çµ±ï¼‰æš«æ™‚æœ‰äº›ç–²æ†Šï¼Œè«‹ç¨å¾Œå†è©¦ã€‚ï¼ˆAPI Errorï¼‰" }]);
            } finally {
              setIsLoading(false);
            }
          };

          const handleSend = () => {
            if (!inputText.trim()) return;
            
            const newMsg = { role: 'user', text: inputText };
            setMessages(prev => [...prev, newMsg]);
            setInputText('');
            callGemini(inputText);
          };

          return (
            <div className="space-y-6 animate-fadeIn h-[600px] flex flex-col">
              <SectionHeader 
                title="âœ¨ AI æ­·å²å¯¦é©—å®¤" 
                subtitle="èˆ‡æ­·å²äººç‰©å°è©±ï¼Œæ¨æ¼”æ­·å²è®Šå±€"
                color="indigo"
              />

              <div className="flex flex-col md:flex-row gap-4 h-full">
                {/* Sidebar / Controls */}
                <div className="md:w-1/4 space-y-3">
                  <p className="text-sm font-bold text-stone-500 uppercase tracking-wider">é¸æ“‡æ¨¡å¼</p>
                  
                  <button 
                    onClick={() => handlePersonaChange('li-hongzhang')}
                    className={`w-full p-3 rounded-lg flex items-center gap-3 transition-all text-left border ${selectedPersona === 'li-hongzhang' ? 'bg-red-100 border-red-300 text-red-900' : 'bg-white border-stone-200 hover:bg-stone-50'}`}
                  >
                    <div className="p-2 bg-red-100 rounded-full"><Anchor size={16} className="text-red-800"/></div>
                    <div>
                      <div className="font-bold">å°è©±ï¼šæé´»ç« </div>
                      <div className="text-xs opacity-75">æ´‹å‹™é‹å‹•è¦–è§’</div>
                    </div>
                  </button>

                  <button 
                    onClick={() => handlePersonaChange('kang-youwei')}
                    className={`w-full p-3 rounded-lg flex items-center gap-3 transition-all text-left border ${selectedPersona === 'kang-youwei' ? 'bg-blue-100 border-blue-300 text-blue-900' : 'bg-white border-stone-200 hover:bg-stone-50'}`}
                  >
                    <div className="p-2 bg-blue-100 rounded-full"><Scroll size={16} className="text-blue-800"/></div>
                    <div>
                      <div className="font-bold">å°è©±ï¼šåº·æœ‰ç‚º</div>
                      <div className="text-xs opacity-75">ç¶­æ–°è®Šæ³•è¦–è§’</div>
                    </div>
                  </button>

                  <button 
                    onClick={() => handlePersonaChange('scenario')}
                    className={`w-full p-3 rounded-lg flex items-center gap-3 transition-all text-left border ${selectedPersona === 'scenario' ? 'bg-purple-100 border-purple-300 text-purple-900' : 'bg-white border-stone-200 hover:bg-stone-50'}`}
                  >
                    <div className="p-2 bg-purple-100 rounded-full"><Sparkles size={16} className="text-purple-800"/></div>
                    <div>
                      <div className="font-bold">æ­·å²æ¨æ¼”</div>
                      <div className="text-xs opacity-75">å‡è¨­æ€§å•é¡Œåˆ†æ</div>
                    </div>
                  </button>

                  <div className="bg-indigo-50 p-4 rounded-lg border border-indigo-100 mt-4">
                    <p className="text-xs text-indigo-800 font-bold mb-2">ğŸ’¡ è©¦è‘—å•å•ï¼š</p>
                    <ul className="text-xs text-indigo-700 space-y-2 list-disc list-inside cursor-pointer">
                      {selectedPersona === 'li-hongzhang' && (
                        <>
                          <li onClick={() => setInputText("ç‚ºä»€éº¼ä½ è¦ç°½è¨‚é¦¬é—œæ¢ç´„ï¼Ÿ")}>ç‚ºä»€éº¼ä½ è¦ç°½è¨‚é¦¬é—œæ¢ç´„ï¼Ÿ</li>
                          <li onClick={() => setInputText("æ´‹å‹™é‹å‹•ç‚ºä»€éº¼å¤±æ•—äº†ï¼Ÿ")}>æ´‹å‹™é‹å‹•ç‚ºä»€éº¼å¤±æ•—äº†ï¼Ÿ</li>
                        </>
                      )}
                      {selectedPersona === 'kang-youwei' && (
                        <>
                          <li onClick={() => setInputText("å»¢é™¤å…«è‚¡æ–‡ä¸æœƒå¾—ç½ªå¤ªå¤šäººå—ï¼Ÿ")}>å»¢é™¤å…«è‚¡æ–‡ä¸æœƒå¾—ç½ªå¤ªå¤šäººå—ï¼Ÿ</li>
                          <li onClick={() => setInputText("æ—¥æœ¬æ˜æ²»ç¶­æ–°ç‚ºä»€éº¼æˆåŠŸäº†ï¼Ÿ")}>æ—¥æœ¬æ˜æ²»ç¶­æ–°ç‚ºä»€éº¼æˆåŠŸäº†ï¼Ÿ</li>
                        </>
                      )}
                      {selectedPersona === 'scenario' && (
                        <>
                          <li onClick={() => setInputText("å¦‚æœå…‰ç·’çš‡å¸æ®ºäº†æ…ˆç¦§ï¼Œè®Šæ³•æœƒæˆåŠŸå—ï¼Ÿ")}>å¦‚æœå…‰ç·’æ®ºäº†æ…ˆç¦§ï¼Œè®Šæ³•æœƒæˆåŠŸå—ï¼Ÿ</li>
                          <li onClick={() => setInputText("å¦‚æœæ´‹å‹™é‹å‹•æˆåŠŸäº†ï¼Œé‚„æœƒæœ‰ç¶­æ–°å—ï¼Ÿ")}>å¦‚æœæ´‹å‹™æˆåŠŸï¼Œé‚„æœƒæœ‰ç¶­æ–°å—ï¼Ÿ</li>
                        </>
                      )}
                    </ul>
                  </div>
                </div>

                {/* Chat Area */}
                <div className="md:w-3/4 flex flex-col bg-stone-50 rounded-xl border border-stone-200 overflow-hidden relative">
                  {/* Messages */}
                  <div className="flex-1 overflow-y-auto p-4 space-y-4">
                    {messages.map((msg, idx) => (
                      <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                        <div className={`flex max-w-[80%] gap-3 ${msg.role === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>
                          <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${msg.role === 'user' ? 'bg-stone-700 text-white' : 'bg-white border border-stone-200'}`}>
                            {msg.role === 'user' ? <User size={16} /> : personas[selectedPersona].avatar}
                          </div>
                          <div className={`p-3 rounded-2xl text-sm leading-relaxed shadow-sm ${
                            msg.role === 'user' 
                              ? 'bg-stone-800 text-white rounded-tr-none' 
                              : 'bg-white border border-stone-200 text-stone-800 rounded-tl-none'
                          }`}>
                            {msg.text}
                          </div>
                        </div>
                      </div>
                    ))}
                    {isLoading && (
                      <div className="flex justify-start w-full animate-pulse">
                        <div className="flex max-w-[80%] gap-3">
                          <div className="w-8 h-8 rounded-full bg-white border border-stone-200 flex items-center justify-center">
                           <Bot size={16} className="text-stone-400"/>
                          </div>
                          <div className="p-3 bg-white rounded-2xl rounded-tl-none border border-stone-200 text-stone-400 text-sm">
                            æ­£åœ¨æ€è€ƒæ­·å²è„ˆçµ¡... âœ¨
                          </div>
                        </div>
                      </div>
                    )}
                    <div ref={messagesEndRef} />
                  </div>

                  {/* Input */}
                  <div className="p-4 bg-white border-t border-stone-200 flex gap-2">
                    <input 
                      type="text" 
                      value={inputText}
                      onChange={(e) => setInputText(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                      placeholder={mode === 'scenario' ? "è¼¸å…¥ä½ çš„æ­·å²å‡è¨­..." : `å‘${personas[selectedPersona].name}æå•...`}
                      className="flex-1 border border-stone-300 rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
                      disabled={isLoading}
                    />
                    <button 
                      onClick={handleSend}
                      disabled={isLoading || !inputText.trim()}
                      className="bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                    >
                      <Send size={18} />
                    </button>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const CompareSection = () => (
          <div className="space-y-8 animate-fadeIn">
            <SectionHeader 
              title="æ¯”è¼ƒèˆ‡æ·±åº¦ç¸½çµ" 
              subtitle="å¾ã€Œå™¨ç‰©ã€åˆ°ã€Œåˆ¶åº¦ã€çš„è·¨è¶Š"
              color="emerald"
            />
            
            <div className="bg-white border border-stone-200 rounded-xl shadow-lg overflow-hidden">
              <div className="grid grid-cols-3 bg-stone-100 p-4 font-bold text-stone-700 border-b border-stone-300">
                <div className="col-span-1">æ¯”è¼ƒé …ç›®</div>
                <div className="col-span-1 text-red-800">æ´‹å‹™é‹å‹•</div>
                <div className="col-span-1 text-blue-800">æˆŠæˆŒç¶­æ–°</div>
              </div>
              
              <CompareRow 
                label="å­¸ç¿’å°è±¡" 
                left="è¥¿æ–¹æŠ€è¡“ (å™¨ç‰©)" 
                right="è¥¿æ–¹æ”¿æ²»åˆ¶åº¦ (åˆ¶åº¦)" 
              />
              <CompareRow 
                label="æŒ‡å°æ€æƒ³" 
                left="ä¸­å­¸ç‚ºé«”ï¼Œè¥¿å­¸ç‚ºç”¨ (ç¶­è­·èˆŠé«”åˆ¶)" 
                right="è®Šæ³•åœ–å¼·ï¼Œå›ä¸»ç«‹æ†² (æ”¹é©èˆŠé«”åˆ¶)" 
              />
              <CompareRow 
                label="æ”¹é©ç¯„åœ" 
                left="å±€é™æ–¼è»äº‹ã€ç¶“æ¿Ÿã€æŠ€è¡“æ•™è‚²" 
                right="å…¨é¢æ¶‰åŠæ”¿æ²»ã€ç¶“æ¿Ÿã€æ–‡åŒ–ã€è»äº‹" 
                highlight={true}
              />
              <CompareRow 
                label="åƒèˆ‡ç¾¤é«”" 
                left="åœ°ä¸»éšç´šæ´‹å‹™æ´¾ (å®˜åƒš)" 
                right="è³‡ç”¢éšç´šç¶­æ–°æ´¾ (çŸ¥è­˜åˆ†å­)" 
              />
              <CompareRow 
                label="æ€§è³ª" 
                left="åœ°ä¸»éšç´šè‡ªæ•‘é‹å‹•" 
                right="è³‡ç”¢éšç´šæ”¹è‰¯é‹å‹•" 
              />
            </div>

            <div className="bg-emerald-50 p-6 rounded-xl border border-emerald-200 mt-6">
              <h3 className="text-xl font-bold text-emerald-900 mb-3 flex items-center gap-2">
                <CheckCircle size={24} />
                è€å¸«çš„ç¸½çµï¼šç‚ºä½•ç¶­æ–°æ›´å…¨é¢ï¼Ÿ
              </h3>
              <p className="text-stone-700 leading-relaxed mb-4">
                å„ä½åŒå­¸ï¼Œé€éæ¯”è¼ƒæˆ‘å€‘å¯ä»¥ç™¼ç¾ï¼Œæ´‹å‹™é‹å‹•çš„å¤±æ•—è­‰æ˜äº†<strong>å–®ç´”å¼•é€²æŠ€è¡“ï¼ˆèˆ¹å …ç ²åˆ©ï¼‰ç„¡æ³•æŒ½æ•‘è…æ•—çš„å°å»ºå¸åœ‹</strong>ã€‚å°±åƒä¸€é–“ç ´èˆŠçš„æˆ¿å­ï¼Œåªæ›äº†æ–°çš„å¤§é–€ï¼ˆæ­¦å™¨ï¼‰ï¼Œä½†æ¨‘æŸ±ï¼ˆåˆ¶åº¦ï¼‰å·²ç¶“è…æœ½ï¼Œæˆ¿å­ä¾ç„¶æœƒå€’å¡Œã€‚
              </p>
              <p className="text-stone-700 leading-relaxed">
                æˆŠæˆŒç¶­æ–°çš„é€²æ­¥ä¹‹è™•ï¼Œåœ¨æ–¼ç¶­æ–°æ´¾èªè­˜åˆ°äº†é€™ä¸€é»ã€‚ä»–å€‘è©¦åœ–å¾<strong>åˆ¶åº¦</strong>å…¥æ‰‹ï¼Œæ”¹é©å®˜åˆ¶ã€æ³•å¾‹å’Œæ•™è‚²ã€‚é›–ç„¶å› ç‚ºè§¸å‹•äº†å®ˆèˆŠå‹¢åŠ›çš„æ ¹æœ¬åˆ©ç›Šè€Œè¿…é€Ÿå¤±æ•—ï¼Œä½†å®ƒæ¨™èªŒè‘—ä¸­åœ‹è¿‘ä»£åŒ–æ¢ç´¢é€²å…¥äº†ä¸€å€‹æ›´æ·±å±¤æ¬¡çš„éšæ®µï¼Œç‚ºå¾Œä¾†çš„è¾›äº¥é©å‘½åŸ‹ä¸‹äº†ä¼ç­†ã€‚
              </p>
            </div>
          </div>
        );

        // --- Helper Components ---

        const SectionHeader = ({ title, subtitle, color }) => (
          <div className="mb-6">
            <h2 className={`text-3xl font-bold text-${color}-900 mb-1`}>{title}</h2>
            <div className={`h-1 w-20 bg-${color}-700 mb-2 rounded`}></div>
            <p className="text-stone-500 italic">{subtitle}</p>
          </div>
        );

        const DetailCard = ({ title, icon, children }) => (
          <div className="bg-white p-5 rounded-xl shadow-md border-t-4 border-stone-300 hover:border-stone-400 transition-colors">
            <div className="flex items-center gap-2 mb-3 text-stone-800 font-bold text-lg border-b pb-2">
              {icon}
              {title}
            </div>
            {children}
          </div>
        );

        const MeasureItem = ({ category, desc, examples }) => (
          <div className="bg-white p-4 rounded-lg shadow-sm border border-stone-100">
            <h4 className="font-bold text-red-900 mb-1">{category}</h4>
            <p className="text-xs text-stone-500 mb-3">{desc}</p>
            <div className="space-y-1">
              {examples.map((ex, i) => (
                <div key={i} className="text-xs bg-stone-100 px-2 py-1 rounded text-stone-700 truncate">
                  â€¢ {ex}
                </div>
              ))}
            </div>
          </div>
        );

        const ResultCard = ({ type, title, children }) => {
          const isSuccess = type === 'success';
          const colorClass = isSuccess ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
          const textClass = isSuccess ? 'text-green-900' : 'text-red-900';
          const icon = isSuccess ? <CheckCircle className="text-green-700" /> : <AlertTriangle className="text-red-700" />;

          return (
            <div className={`p-6 rounded-xl border ${colorClass}`}>
              <h3 className={`text-lg font-bold ${textClass} mb-3 flex items-center gap-2`}>
                {icon} {title}
              </h3>
              <div className="text-stone-700">
                {children}
              </div>
            </div>
          );
        };

        const CompareRow = ({ label, left, right, highlight = false }) => (
          <div className={`grid grid-cols-3 p-4 border-b border-stone-100 text-sm hover:bg-stone-50 transition-colors ${highlight ? 'bg-yellow-50' : ''}`}>
            <div className="col-span-1 font-bold text-stone-700 flex items-center">{label}</div>
            <div className="col-span-1 text-stone-600 pr-2">{left}</div>
            <div className="col-span-1 text-stone-600 font-medium">{right}</div>
          </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<QingReformLesson />);
    </script>
</body>
</html>
